<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Статистика и R в науке и аналитике</title>
<link>https://ubogoeva.github.io/R4Analytics/</link>
<atom:link href="https://ubogoeva.github.io/R4Analytics/index.xml" rel="self" type="application/rss+xml"/>
<description>Блог Елены Убогоевой по статистике и анализу данных в R</description>
<language>ru</language>
<generator>quarto-1.4.555</generator>
<lastBuildDate>Wed, 12 Mar 2025 18:00:00 GMT</lastBuildDate>
<item>
  <title>История A/B тестирования: от лечения цинги до цвета ссылок Google</title>
  <dc:creator>Elena U</dc:creator>
  <link>https://ubogoeva.github.io/R4Analytics/posts/history_of_AB_testing.html</link>
  <description><![CDATA[ 
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(97025960, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/97025960" style="position:absolute; left:-9999px;" alt=""></div></noscript>
<!-- /Yandex.Metrika counter -->





<p>Какой A/B тест можно назвать самым первым в истории? Точно сказать сложно — люди всегда сравнивали варианты, чтобы выбрать лучший. Но если искать истоки, то путь этого метода начинается в медицине, задолго до появления термина “A/B”. И поэтому история A/B тестирования будет довольно сильно пересекаться с историей медицины и рандомизированных клинических исследований (РКИ).</p>
<section id="джеймс-линд-и-лимоны-против-цинги" class="level3">
<h3 class="anchored" data-anchor-id="джеймс-линд-и-лимоны-против-цинги"><strong>1747: Джеймс Линд и лимоны против цинги</strong></h3>
<p>Наиболее раннее задокументированное контролируемое исследование было проведено шотландским врачом Джеймсом Линдом в 1747 году. На корабле HMS Salisbury он лечил моряков с цингой, разделив 12 человек на шесть пар. Каждая пара получала разное лечение: яблочный сидр, уксус, морскую воду, цитрусовые и другие средства. Те, кто ел лимоны и апельсины, выздоровели за шесть дней. Это считается одним из первых контролируемым экспериментов, хотя распределение на группы не было случайным, а в каждой выборке было всего два человека. Тем не менее, этот опыт стал предшественником современных РКИ.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/images/scurvy.png" class="img-fluid figure-img"></p>
<figcaption>Схема на основании источника “A Treatise of the Scurvy”, 1753</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Забавный факт
</div>
</div>
<div class="callout-body-container callout-body">
<p>Группа с цитрусовыми получала апельсины и лимоны всего шесть дней — не потому, что такая длительность была запланирована, а просто из-за того, что на корабле закончились фрукты. Тем не менее, этого оказалось достаточно, чтобы состояние моряков заметно улучшилось.</p>
</div>
</div>
</section>
<section id="нюрнбергский-тест-соли-и-гомеопатия" class="level3">
<h3 class="anchored" data-anchor-id="нюрнбергский-тест-соли-и-гомеопатия"><strong>1835: Нюрнбергский тест соли и гомеопатия</strong></h3>
<p>В 1835 году в Нюрнберге проверили состоятельность гомеопатии как метода. Гомеопат Иоганн Якоб Ройтер утверждал, что соль в C30-разведении (10⁻⁶⁰) вызовет ‘необычные ощущения’ (нем. <em>außerordentliche Empfindungen</em>), особенно у больных. Врачи собрали 100 добровольцев, подготовили 100 флаконов — 50 с дистиллированной водой, 50 с гомеопатической солью, — распределив их случайным образом и втайне от участников и исследователей. Через три недели 50 участников отчитались: 8 почувствовали что-то необычное (5 из ‘солевой’ группы, 3 из контрольной), но разница оказалась статистически незначимой. Организаторы объявили гомеопатию несостоятельной, а тест стал первым рандомизированным двойным слепым испытанием и одним из предшественников A/B тестов, хотя современные A/B обычно не используют двойную слепоту.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Комментарий
</div>
</div>
<div class="callout-body-container callout-body">
<p>Из 100 участников только 54 участника вернулись с отчетом о своем состоянии, но учли только 50 (27 с солью, 23 с водой): четыре человека исключены из-за нарушений протокола, что объясняет меньшее число отчитавшихся.</p>
<p>Критики эксперимента отмечали, что его результаты нельзя считать убедительными доказательствами против гомеопатии, так как большинство добровольцев были здоровыми, тогда как гомеопаты, включая Ройтера, утверждали, что их методы эффективны именно для лечения больных.</p>
<p>Почитать статью об этой истории можно <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC1676327/">здесь</a>.</p>
</div>
</div>
</section>
<section id="е-игнац-земмельвейс-и-спасение-матерей" class="level3">
<h3 class="anchored" data-anchor-id="е-игнац-земмельвейс-и-спасение-матерей"><strong>1840-е: Игнац Земмельвейс и спасение матерей</strong></h3>
<p>В 1846 году венгерский врач Игнац Земмельвейс работал в Венской больнице и заметил пугающую закономерность: в одном родильном отделении женщины умирали от родильной горячки в разы чаще, чем в другом. Он сравнил два отделения: в первом рожениц принимали врачи, во втором — акушерки. Земмельвейс предположил, что врачи, приходившие со вскрытий в анатомическом отделении, заносят инфекцию. В 1847 году он начал эксперимент: заставил врачей мыть руки хлорным раствором перед родами. Смертность упала с пиковых 18% до 1-2% в течение месяцев. Он сравнивал смертность до и после вмешательства в одном отделении, используя другое как неформальный контроль, что предшествовало A/B тестированию и напоминало метод Diff-in-Diff (разница в разностях), хотя без рандомизации и строгой статистики.</p>
</section>
<section id="е-рональд-фишер-и-сельское-хозяйство" class="level3">
<h3 class="anchored" data-anchor-id="е-рональд-фишер-и-сельское-хозяйство"><strong>1920-е: Рональд Фишер и сельское хозяйство</strong></h3>
<p>Настоящий переворот в методологии экспериментов произошел в XX веке благодаря британскому статистику и биологу-эволюционисту Рональду Фишеру. В 1920-х годах, работая на сельскохозяйственной станции Rothamsted в Англии, он заложил основы современного экспериментального дизайна: сформулировал и систематизировал три ключевых принципа: <strong>рандомизацию</strong>, <strong>репликацию</strong> и <strong>блокирование</strong>. Сравнивая урожайность полей — например, пшеницы с разными удобрениями, — Фишер понял, что случайное распределение участков на группы (рандомизация) исключает “шум”, такой как различия в почве или погоде, делая выводы более надёжными. Для повышения точности он ввёл репликацию — повторение эксперимента на нескольких участках, что позволяло отличить случайные колебания от реального эффекта. А для учёта известных переменных, таких как тип почвы или уклон поля, он разработал блокирование — разделение участков на группы с похожими условиями, внутри которых и проводился тест. Эти идеи, впервые изложенные в статье <em>“The Arrangement of Field Experiments”</em> (1926) и окончательно оформленные в книге <em>“The Design of Experiments”</em> (1935), перекочевали из сельского хозяйства в медицину, став фундаментом современных клинических испытаний, а затем и A/B тестов.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/history_of_AB_testing_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>На картинке выше показаны принципы рандомизации и блокирования, но может показаться, что тип почвы — основной фактор обработки (fixed effect). На самом деле в данном дизайне почва выступает как блокирующий фактор (blocking factor), влияние которого мы учитываем, чтобы изолировать эффект удобрений.</p>
</div>
</div>
</div>
</section>
<section id="конец-xix-начало-xx-века-маркетинг-и-почтовые-рассылки" class="level3">
<h3 class="anchored" data-anchor-id="конец-xix-начало-xx-века-маркетинг-и-почтовые-рассылки"><strong>Конец XIX – начало XX века: Маркетинг и почтовые рассылки</strong></h3>
<p>Идея сравнения вариантов вышла за пределы медицины в маркетинг. В конце XIX века, с ростом прямой почтовой рекламы (direct mail), компании начали тестировать эффективность объявлений. Например, в США в 1870-х годах каталог Montgomery Ward рассылал разные версии писем клиентам, сравнивая отклик. К началу XX века рекламные агентства, такие как Lord &amp; Thomas (предшественник Foote, Cone &amp; Belding), систематизировали этот подход: отправляли две версии каталога или письма (A и B) разным группам и измеряли продажи. Распределение не всегда было случайным, но это стало прообразом A/B тестирования в бизнесе, где выбор лучшего варианта опирался на цифры, а не интуицию.</p>
</section>
<section id="е-2000-е-google-и-цифровая-эпоха" class="level3">
<h3 class="anchored" data-anchor-id="е-2000-е-google-и-цифровая-эпоха"><strong>1990-е – 2000-е: Google и цифровая эпоха</strong></h3>
<p>С приходом интернета A/B тестирование шагнуло в бизнес. В 2009 году Google провёл легендарный эксперимент: инженеры протестировали 41 оттенок синего для ссылок в поисковике. Даже малозаметная разница в цвете, по их оценкам, принесла миллионы долларов. Однако этот кейс вызывает вопросы: многие оттенки могли быть неразличимы на разных мониторах из-за настроек цвета или качества экранов, что ставит под сомнение чистоту эксперимента. Подробнее об этом можно прочитать в <a href="https://www.insights4print.ceo/2022/02/the-google-41-shades-of-blue-test-is-fundamentally-flawed/">статье</a>. Тем не менее, пример Google показал, как A/B тестирование адаптировалось к новым задачам, далеко уйдя от своих медицинских корней.</p>
<div class="callout callout-style-simple callout-important">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Этот эксперимент не был первым A/B тестом в современном бизнес-контексте — за первенство спорят Amazon и Microsoft, — но стал одним из самых известных. Подробнее тесты Amazon и других компаний рассмотрим в одном из следующих постов.</p>
</div>
</div>
</div>
</section>
<section id="сегодня-от-кнопок-до-алгоритмов" class="level3">
<h3 class="anchored" data-anchor-id="сегодня-от-кнопок-до-алгоритмов"><strong>Сегодня: от кнопок до алгоритмов</strong></h3>
<p>Сегодня A/B тестирование — неотъемлемая часть IT и маркетинга. Проверяют всё: от заголовков в приложениях до тонких настроек алгоритмов рекомендаций. Современные платформы позволяют автоматизировать процесс — от запуска тестов до подведения итогов, делая его быстрым и удобным (но все равно нередко приходится подводить итоги вручную). Аналитики и продакт-менеджеры порой забывают: их модные A/B тесты — это, по сути, упрощённая версия рандомизированных клинических исследований. Метод уходит корнями к пионерам вроде Линда и Фишера, и важно помнить, кто заложил его основы, пока мы красим кнопки и сравниваем результаты.</p>
<p><img src="https://ubogoeva.github.io/R4Analytics/images/logo_final_tlg.png" class="img-fluid"></p>


</section>

 ]]></description>
  <category>statistics</category>
  <category>analytics</category>
  <guid>https://ubogoeva.github.io/R4Analytics/posts/history_of_AB_testing.html</guid>
  <pubDate>Wed, 12 Mar 2025 18:00:00 GMT</pubDate>
</item>
<item>
  <title>Разбор курса ‘Основы статистики’</title>
  <dc:creator>Elena U</dc:creator>
  <link>https://ubogoeva.github.io/R4Analytics/posts/review_of_statistics_course.html</link>
  <description><![CDATA[ 
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(97025960, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/97025960" style="position:absolute; left:-9999px;" alt=""></div></noscript>
<!-- /Yandex.Metrika counter -->





<p>По итогам многочисленных дискуссий в чатах по статистике и биоинформатике (<a href="https://t.me/chat_biostat_R" target="_blank">BioStat &lt;- R | Чат по статистике и R</a>, <a href="https://t.me/bioinf_career" target="_blank">BIOINF | Education &amp; Career</a>), я решила написать обзор на курс <a href="https://stepik.org/course/76/syllabus" target="_blank">“Основы статистики”</a> на платформе stepik. Давайте разберем его достоинства и недостатки, а также есть ли смысл его смотреть сейчас.</p>
<section id="общее-описание-курса" class="level2">
<h2 class="anchored" data-anchor-id="общее-описание-курса">Общее описание курса</h2>
<p>Немного контекста: курс был опубликован в начале 2015го года, и был одним из первых бесплатных русскоязычных курсов по статистике (а может и самый первый). Конечно, были и есть книги, но не было лекций в интерактивном формате.<br>
К тому же не все переводы книг по статистике хороши, например, перевод книги Гланца “<u>Медико-биологическая статистика</u>” оставляет желать лучшего. Книга “<u>Статистика и котики</u>”, которая хороша для старта в статистике, была опубликована позже, в 2016. Это я к тому, что такого многообразия материалов по статистике, как появилось в последние ~5 лет еще не было, и на тот момент вводный курс по основам статистики был очень актуален для сообщества.</p>
<p>Я сама посмотрела курс “Основы статистики” в 2017 году, после довольно слабого курса по статистике в университете, и для меня курс был полезен для старта, после чего продолжила изучать статистику преимущественно по книгам (а сейчас преподаю сама). В тот момент курс показался достойным, мне понравился простой язык изложения, расчет формул на игрушечных примерах, а также удобный интерактивный формат заданий и их проверки на степике.</p>
<p>Курс состоит из трех блоков:</p>
<ol type="1">
<li>Введение, выборка и генеральная совокупность, типы переменных, описательная статистика, ЦПТ, p-value.</li>
<li>Сравнение средних: t-test, однофакторная и многофакторная ANOVA, проблема множественных тестирований.</li>
<li>Корреляция и простая и множественная линейная регрессия, отбор моделей.</li>
</ol>
<p>В общем такой джентльменский набор тем для старта.</p>
<p>Разберем подробно каждую часть, выделяя что понравилось, а также указывая на неточности и ошибки. Платформа степик не позволяет делать ссылки с таймкодами, поэтому буду прикреплять ссылки на видео и подписывать время в тексте.</p>
</section>
<section id="первая-часть-введение" class="level2">
<h2 class="anchored" data-anchor-id="первая-часть-введение">Первая часть: введение</h2>
<p>Общее впечатление: большая часть вещей объяснена нормально, неплохой блок про статистический вывод, объяснено, чем p-value является и не является, но при этом проскальзывают неосторожные формулировки, а иногда и ошибки. Основные разобраны ниже, а также отдельно вынесены терминологические неточности (в основном что касается принять нулевую гипотезу и тп).</p>
<section id="описательные-статистики-смещенные-и-несмещенные-оценки" class="level3">
<h3 class="anchored" data-anchor-id="описательные-статистики-смещенные-и-несмещенные-оценки">Описательные статистики: смещенные и несмещенные оценки</h3>
<p>По всему разделу описательных статистик перескакивает мысль с дисперсии генеральной совокупности на дисперсию выборки, в знаменателе формулы то <img src="https://latex.codecogs.com/png.latex?n">, то <img src="https://latex.codecogs.com/png.latex?n-1">, плюс не хватило объяснения, почему используются греческие или латинские буквы для обозначения дисперсии или среднего, это сбивает с толку слушателей.</p>
<p>Анатолий Карпов <a href="https://stepik.org/lesson/8076/step/5?unit=1356" target="_blank">объясняет</a> (на 3.30), что <img src="https://latex.codecogs.com/png.latex?n-1"> в знаменателе формулы дисперсии выборки связано со степенями свободы, но это не совсем так. Такое же <a href="https://stepik.org/lesson/8086/step/4?unit=1365" target="_blank">объяснение</a> приводится и для коэффициента корреляции, хотя в расчете коэффициента корреляции вообще степеней свободы <img src="https://latex.codecogs.com/png.latex?n-2">.<br>
Здесь важно прояснить две вещи. Первое: при делении на <img src="https://latex.codecogs.com/png.latex?n"> у нас систематически занижается дисперсия выборки относительно дисперсии генеральной совокупности, и деление на <img src="https://latex.codecogs.com/png.latex?n-1"> позволяет получить несмещенную оценку дисперсии (<a href="https://www.youtube.com/watch?v=sHRBg6BhKjI" target="_blank">здесь</a> или <a href="https://www.youtube.com/watch?v=pLH1QA4F9uE" target="_blank">здесь</a> можно посмотреть, как это происходит). Второе: при растущем объеме выборки обе формулы дают значение, которое приближается к дисперсии генеральной совокупности. То есть в курсе объяснение через степени свободы не совсем ошибка, но немного уводит в сторону.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Комментарий
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://en.wikipedia.org/wiki/Bessel%27s_correction#Proof">Почему именно n-1 в знаменателе</a></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Обсуждение в чате Биостата
</div>
</div>
<div class="callout-body-container callout-body">
<p>Вот начиная с этого <a href="https://t.me/chat_biostat_R/22168">сообщения</a> обсудили, что в принципе это объяснение тоже имеет смысл</p>
</div>
</div>
<p>Кроме этого, стандартное отклонение называется в лекциях и стандартным, и среднеквадратичным отклонением. Понятно, что это одно и то же, но это не было проговорено явно, в результате слушатели курса в растерянности. Исторически в русскоязычной литературе использовался вариант “среднеквадратичное отклонение”, но сейчас чаще встречается вариант “стандартное отклонение”, мне кажется это более правильно, так как прямой перевод standard deviation.</p>
<p>Вот <a href="https://stepik.org/lesson/9294/step/5?unit=1827" target="_blank">тут</a> сказано, что между первым и третьим квартилем в боксплоте находится ровно 50% наблюдений. В принципе это часто так, но не обязательно, например, это будет неверно в случае, если в данных есть повторяющиеся значения.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">boxplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/review_of_statistics_course_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Здесь в “ящике” бокса находится 7/8 значений, то есть 87.5%. Можно придумать и совсем экстремальный случай, когда в ящике бокса находятся все наблюдения и “усов” нет совсем. Конечно, это редко когда встречается, но в любом случае проявление неаккуратности формулировки, хотя и не слишком существенное.</p>
<p>А вот следующий пример будет гораздо хуже ⬇️</p>
</section>
<section id="доверительные-интервалы-которым-нельзя-доверять" class="level3">
<h3 class="anchored" data-anchor-id="доверительные-интервалы-которым-нельзя-доверять">Доверительные интервалы, которым нельзя доверять</h3>
<p>Вот <a href="https://stepik.org/lesson/9249/step/8?unit=1829" target="_blank">тут</a> было что-то совсем странное с интерпретацией доверительных интервалов (с 1.05).</p>
<p>Дословно текст:</p>
<blockquote class="blockquote">
<p>Потому что если у нас среднее номер 2 не попадает в доверительный интервал для среднего номер 1, и наоборот, среднее номер 1 не попадает в доверительный интервал для среднего номер 2, то такие различия у нас будут достигать уровня статистической значимости.</p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/images/conf_interval.PNG" class="img-fluid figure-img"></p>
<figcaption>Скриншот из видео</figcaption>
</figure>
</div>
<p>Такая интерпретация перекрывания доверительных интервалов совсем неверная.</p>
<p>Здесь я <a href="https://ubogoeva.github.io/R4Analytics/posts/types_of_error_bars.html" target="_blank">писала</a> про доверительные интервалы и пределы погрешностей. В двух словах: отсутствие перекрывания 95% доверительных интервалов говорит о статистически значимых различиях (p &lt; 0.05), но речь идет именно о перекрывании <strong><em>усов</em></strong>, а вовсе не о том, что доверительный интервал одной выборки не перекрывается с <strong><em>выборочным</em></strong> <strong><em>средним</em></strong> второй.<br>
Перекрывание усов со средним не интерпретируется в терминах статистической значимости. На картинке выше доверительные интервалы перекрываются, и это не говорит о том, что различий нет, поскольку только <em>отсутствие</em> перекрывания говорит о статистически значимых различиях:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/images/se_overlap.png" class="img-fluid figure-img"></p>
<figcaption>Интерпретация перекрывания пределов погрешностей, доверительные интервалы — 95% CI. Ссылка на <a href="https://www.graphpad.com/support/faq/spanwhat-you-can-conclude-when-two-error-bars-overlap-or-dontspan/" target="_blank">источник</a> картинки</figcaption>
</figure>
</div>
<p><em>Наличие</em> перекрывания <em>не</em> говорит о том, что различий нет. Еще стоит отметить, что в принципе делать выводы о различиях средних на основании перекрывания/не перекрывания доверительных интервалов плохая практика.</p>
<p>Считаю это очень серьезной неточностью и даже ошибкой курса, учитывая, что в целом доверительный интервал как явление дает простор для мисинтерпретации, так еще и в курсе приведено заведомо неверное объяснение.</p>
</section>
<section id="баг-про-центральную-предельную-теорему" class="level3">
<h3 class="anchored" data-anchor-id="баг-про-центральную-предельную-теорему">Баг про центральную предельную теорему</h3>
<p>Дмитрий Пензар достаточно подробно про это <a href="https://vk.com/@dmitry_penzar-stats-and-pulverization" target="_blank">расписал</a>, главное замечание в том, что в формулировке Карпова ЦПТ становится практически бесполезной (ссылка на <a href="https://stepik.org/lesson/8077/step/6?unit=1357" target="_blank">лекцию</a>).</p>
<blockquote class="blockquote">
<p>Предположим исследуемый нами признак имеет нормальное распределение в генеральной совокупности с некоторым средним и стандартным отклонением, и мы многократно извлекаем выборки равные n по объему, и в каждой выборке рассчитываем среднее значение, после чего строим распределение этих выборочных средних. Так вот, такое распределение будет являться нормальным со средним, совпадающим с этим показателем генеральной совокупности. И, что самое интересное, со стандартным отклонением, которое называется стандартная ошибка среднего, se равным sigma/корень(n).</p>
</blockquote>
<p>Не хватило объяснения основной сути ЦПТ.</p>
<p>Основная суть ЦПТ в том, что <strong>какой бы ни была форма распределения в генеральной совокупности, выборочное распределение средних будет стремиться к нормальному</strong>. Это применимо для признака, который обладает конечными математическим ожиданием и дисперсией.</p>
<p>Иллюстрация на примере логнормального распределения:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">log_distr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rlnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># создаем "генеральную совокупность"</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(log_distr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># строим гистограмму</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/review_of_statistics_course_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Извлекаем тысячу раз выборки размером 30, считаем среднее этих выборок, построим распределение.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">samp_means_log <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(log_distr, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>))) </span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(samp_means_log, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/review_of_statistics_course_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Распределение выборочных средних из логнормального распределения получилось очень похожим на нормальное распределение. Это происходит благодаря центральной предельной теореме.</p>
<p>Вот тут можно посмотреть еще: <a href="https://gallery.shinyapps.io/CLT_mean/" target="_blank">Шайни апп для центральной предельной теоремы</a>, особенно эффектно выглядит на примере равномерного распределения.</p>
</section>
</section>
<section id="вторая-часть-сравнение-средних" class="level2">
<h2 class="anchored" data-anchor-id="вторая-часть-сравнение-средних">Вторая часть: сравнение средних</h2>
<p>Общее впечатление: самая слабая часть курса, наибольшее количество ошибок сосредоточено именно здесь. При этом лайк за объяснение однофакторного дисперсионного анализа и разбор проблематики множественного тестирования.</p>
<section id="про-тест-стьюдента-без-теста-велча" class="level3">
<h3 class="anchored" data-anchor-id="про-тест-стьюдента-без-теста-велча">Про тест Стьюдента без теста Велча</h3>
<p><a href="https://stepik.org/lesson/9249/step/2?unit=1829" target="_blank">Здесь</a> некорректно назван t-тест почему-то парным t-тестом. Видимо имелся ввиду двухвыборочный t-тест. Напоминаю, что парный или <em>зависимый</em> t-тест применяется к <em>зависимым</em> выборкам и формула расчета его другая.</p>
<p>По всему курсу t-критерий Стьюдента называется <code>критерий t-Стьюдента</code>.</p>
<p>Странная <a href="https://stepik.org/lesson/9249/step/3?unit=1829" target="_blank">постановка нулевой и альтернативной гипотезы</a> (0.20):</p>
<blockquote class="blockquote">
<p>нулевая гипотеза, будет предполагать, что на самом деле в генеральной совокупности никакого различия между этими средними значениями нет, тогда как альтернативная гипотеза &lt;…&gt; будет говорить, что на самом деле эти средние в генеральной совокупности не равны.</p>
</blockquote>
<p>Более правильно будет сказать, что нулевая гипотеза — о том, что две генеральные совокупности (из которых взяты соответствующие выборки) имеют одинаковое среднее. Соответственно альтернативная — о том, что средние в генеральной совокупности не равны.</p>
<p>Далее, не было сказано ничего про тест Велча (тест Стьюдента с поправкой Велча), зато <a href="https://stepik.org/lesson/9249/step/9?unit=1829" target="_blank">сказано</a>, что нужно обязательно равенство дисперсий при сравнении двух групп t-тестом. Для теста Стьюдента без поправки Велча это действительно так, но в целом более надежно с точки зрения ошибки первого рода использовать тест Стьюдента с поправкой Велча.</p>
<p>Я сравнивала тест Стьюдента и тест Велча, вот выдержка из <a href="https://ubogoeva.github.io/R4Analytics/posts/welch_test.html" target="_blank">материала</a>:</p>
<blockquote class="blockquote">
<p>В большинстве случаев оба теста контролируют ошибку первого рода и мощность на заданном уровне. Однако у теста Стьюдента есть проблема с ошибкой первого рода (ложноположительные результаты) в ситуации с неравными дисперсиями и разным размером выборок.</p>
</blockquote>
<table class="caption-top table">
<caption>Здесь ✅ — тест показал себя хорошо, ❌ — тест показал себя плохо, 🟡 — тест показал себя не оптимально, но не слишком плохо</caption>
<colgroup>
<col style="width: 47%">
<col style="width: 26%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>тест Велча</th>
<th>тест Стьюдента</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Отличий нет, равные дисперсии, равные выборки</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr class="even">
<td>Отличий нет, разные дисперсии, равные выборки</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr class="odd">
<td>Отличий нет, разные дисперсии, разные выборки, меньшая выборка с большей дисперсией</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr class="even">
<td>Отличий нет, разные дисперсии, разные выборки, бОльшая выборка с большей дисперсией</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr class="odd">
<td>Отличия есть, равные дисперсии, равные выборки</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr class="even">
<td>Отличия есть, разные дисперсии, равные выборки</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr class="odd">
<td>Отличия есть, разные дисперсии, разные выборки, меньшая выборка с большей дисперсией</td>
<td>🟡</td>
<td>✅</td>
</tr>
<tr class="even">
<td>Отличия есть, разные дисперсии, разные выборки, бОльшая выборка с большей дисперсией</td>
<td>✅</td>
<td>🟡</td>
</tr>
</tbody>
</table>
<p>Можно было хотя бы упомянуть про существование теста Велча, учитывая что в большинстве статистических программ считается именно он.</p>
<p>Также <a href="https://stepik.org/lesson/9249/step/9?unit=1829" target="_blank">сказано</a> про нормальность распределения как обязательное требование для t-теста, но только в случае, если значений в выборке меньше 30. Почитать, почему это не так, можно по <a href="https://koch-kir.medium.com/%D0%B8%D1%81%D1%82%D0%BE%D1%80%D0%B8%D1%8F-%D0%BE%D0%B4%D0%BD%D0%BE%D0%B3%D0%BE-%D0%BE%D0%B1%D0%BC%D0%B0%D0%BD%D0%B0-%D0%B8%D0%BB%D0%B8-%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BA-%D1%80%D0%B0%D1%81%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D1%8E-%D0%B2-%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%81%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D1%85-%D1%82%D0%B5%D1%81%D1%82%D0%B0%D1%85-55139a5558d" target="_blank">ссылке</a>. В тексте этой статьи есть неточности, но общий посыл передан верно, ждем Матвея Славенко с подробным разбором этого статистического мифа.</p>
</section>
<section id="про-тест-манна-уитни-недостаточно" class="level3">
<h3 class="anchored" data-anchor-id="про-тест-манна-уитни-недостаточно">Про тест Манна-Уитни: недостаточно</h3>
<p>Очень мимоходом <a href="https://stepik.org/lesson/8082/step/10?unit=1361" target="_blank">сказано</a> про тест Манна-Уитни, не сказано ничего про формулировку нулевой гипотезы, кажется что мы сравниваем средние, только в рангах, а это не совсем так.</p>
<p>Я думаю не помешало бы уделить больше внимания тесту Манна-Уитни, так как тест очень популярен в научном сообществе, для случаев, когда нарушается требование к нормальности распределения.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Рекомендация
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://habr.com/ru/companies/X5Tech/articles/823078/" target="_blank">Большая статья про тест Манна-Уитни</a> на хабре от Сергея Матросова и аналитиков X5 Tech.</p>
</div>
</div>
<p>Не хватило рекомендаций, что делать с выбросами помимо использования непараметрических методов, так как не всегда непараметрика это единственный возможный и верный вариант.</p>
</section>
<section id="про-дисперсионный-анализ" class="level3">
<h3 class="anchored" data-anchor-id="про-дисперсионный-анализ">Про дисперсионный анализ</h3>
<p>Здесь все очень даже неплохо, мне понравился расчет F-значений в дисперсионном анализе вручную и объяснение внутригрупповой и межгрупповой суммы квадратов.</p>
<p>Но все-таки укажу на кое-какие огрехи: <a href="https://stepik.org/lesson/Многофакторный-ANOVA-9250/step/13" target="_blank">тут</a> указано требование к нормальности данных и гомогенности дисперсий, но если наблюдений больше 50, то ANOVA устойчива к нарушению обоих предположений. Это так, но я бы уточнила, что нам важнее нормальность распределения <em>остатков</em>, а не исходных данных. В остальном да, при достаточном размере выборки ANOVA устойчива к нарушению нормальности, а при равенстве объемов выборок в группах к гетерогенности дисперсий.</p>
<p>Про многофакторный дисперсионный анализ рассказано поверхностно, но без ошибок, понятно, что в курсе по <em>основам</em> статистики не изложить все, особенно по теме дисперсионного анализа. Возможно, стоило обратить внимание на то, что бывают разные способы расчета сумм квадратов в двухфакторном дисперсионном анализе, и при разных размерах выборок (= несбалансированный дизайн) это может повлиять на выводы (вот <a href="https://www.youtube.com/watch?v=NKMFgejt3U0" target="_blank">тут</a> можно посмотреть, основная проблема изложена).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Про разные типы сумм квадратов в ANOVA
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://stats.stackexchange.com/questions/20452/how-to-interpret-type-i-type-ii-and-type-iii-anova-and-manova" target="_blank">Статья</a> на stats.stackexchange с подробным разбором разных тип сумм квадратов и их отличием</p>
</div>
</div>
</section>
<section id="про-поправки-на-множественное-тестирование" class="level3">
<h3 class="anchored" data-anchor-id="про-поправки-на-множественное-тестирование">Про поправки на множественное тестирование</h3>
<p>Общая идея <a href="https://stepik.org/lesson/8085/step/3?unit=1364" target="_blank">проиллюстрирована</a> очень хорошо, и мне понравилось, что были использованы симуляции сравнений групп, а не просто формула FWER.</p>
<p>Но не хватило акцентов, какой метод в каком случае лучше использовать.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>FWER — family-wise error rate, групповая вероятность ошибки I рода.</p>
<p>Формула расчета FWER для независимых тестов</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AFWER%20=%201%20-%20(1-%5Calpha)%5Ek,%20%D0%B3%D0%B4%D0%B5%0A"></p>
<p><em>k</em> - количество тестов, <img src="https://latex.codecogs.com/png.latex?%5Calpha"> - уровень значимости.</p>
<p>При сравнении групп тесты зависимые, и по формуле мы можем оценить только верхнюю границу, максимально возможное значение FWER.</p>
</div>
</div>
<p>Для дальнейшего углубления в конкретику, какую поправку использовать лучше, можно ознакомиться с моим <a href="https://ubogoeva.github.io/R4Analytics/posts/multiple_testing.html" target="_blank">постом</a> с детальным разбором поправок и <a href="https://disk.yandex.ru/d/QLnuA-Y3rw_eVg/2" target="_blank">лекцией</a> Матвея Славенко в литклубе биостатистики.</p>
</section>
</section>
<section id="третья-часть-корреляция-и-регрессия" class="level2">
<h2 class="anchored" data-anchor-id="третья-часть-корреляция-и-регрессия">Третья часть: корреляция и регрессия</h2>
<p>Общее впечатление: часть недостаточно подробная, хотелось бы увидеть больше деталей и материалов для дальнейшего изучения. Но серьезных ошибок не было, общая суть методов передана верно.</p>
<section id="корреляция" class="level3">
<h3 class="anchored" data-anchor-id="корреляция">Корреляция</h3>
<p><a href="https://stepik.org/lesson/9992/step/5?unit=1923" target="_blank">Здесь</a> в объяснении преимуществ корреляции Спирмена говорится, что можно нарушить линейность, это так, но при этом важно, чтобы соблюдалась монотонность связи, на это не хватает акцента.</p>
<p>Не хватило методов, что можно сделать с выбросами помимо применения непараметрических тестов. В определенных ситуациях можно удалить выбросы, если они физически невозможны, также можно сделать различные преобразования, например логарифмирование. Но нужно учитывать, что может измениться интерпретация преобразованных данных.</p>
</section>
<section id="регрессия" class="level3">
<h3 class="anchored" data-anchor-id="регрессия">Регрессия</h3>
<p>Здесь <a href="https://stepik.org/lesson/9996/step/2?unit=1926" target="_blank">сказано</a> про опасность экстраполяции, но при этом предсказанное значение лежит за пределами диапазона значений независимых переменных, что уже является экстраполяцией и не совсем корректно.</p>
<p><a href="https://stepik.org/lesson/8090/step/3?unit=1369" target="_blank">Опечатка на слайде</a> и в речи (1.15): в требованиях к множественной линейной регрессии указана гетероскедастичность вместо гомоскедастичности.</p>
<p>Про проблему <a href="https://stepik.org/lesson/9995/step/2?unit=1925" target="_blank">мультиколлинеарности</a> (3.00) маловато конкретики и объяснения причин, почему мультиколлинеарность плохо.</p>
<p>В теме множественной регрессии не хватило про VIF для оценки мультиколлинеарности, про информационные критерии AIC, BIC и методы отбора лучшей модели.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Рекомендация
</div>
</div>
<div class="callout-body-container callout-body">
<p>На тему регрессии рекомендую <a href="https://polydora.github.io/linmodr/lectures.html" target="_blank">курс лекций</a> Марины Варфоломеевой и Вадима Хайтова.</p>
</div>
</div>
<p>Справедливости ради, в третьей части курса (<a href="https://stepik.org/course/2152/syllabus" target="_blank">Основы статистики. Часть 3</a>) это было разобрано более подробно.</p>
</section>
</section>
<section id="terms" class="level2">
<h2 class="anchored" data-anchor-id="terms">Терминологические неточности</h2>
<p>Сюда относятся многочисленные “принять альтернативную гипотезу”, “статистически достоверно” вместо статистически значимо, соберем их в одном месте:</p>
<ul>
<li><p>В ответах к <a href="https://stepik.org/lesson/8083/step/8?unit=1362" target="_blank">заданию</a> “принимаем нулевую гипотезу”</p></li>
<li><p>“<a href="https://stepik.org/lesson/8078/step/7?unit=1358" target="_blank">Считать наши значения статистически достоверными</a>” 0.50</p></li>
<li><p>“<a href="https://stepik.org/lesson/8085/step/3?unit=1364" target="_blank">Принимаем различия статистически достоверными</a>” 1.26 1.45 3.24 5.04. Заметьте, тут в рамках одного видео такая формулировка встречается 4 раза, что нельзя списать на то, что автор просто оговорился.</p></li>
<li><p>На этом степе в задании “<a href="https://stepik.org/lesson/8078/step/11?unit=1358" target="_blank">различия считаются статистически достоверными</a>”.</p></li>
<li><p>В формулировке <a href="https://stepik.org/lesson/9249/step/13?unit=1829" target="_blank">задания</a> “статистически достоверными”.</p></li>
<li><p>“различиям между группами признавались статистически достоверными” в тексте <a href="https://stepik.org/lesson/8085/step/10?unit=1364" target="_blank">задания</a>.</p></li>
<li><p><a href="https://stepik.org/lesson/8086/step/11?unit=1365" target="_blank">принять или отклонить нулевую гипотезу</a> 1.20</p></li>
</ul>
<p>В алгоритме статистического вывода, мы не принимаем нулевую гипотезу, а можешь лишь отклонить нулевую гипотезу или не отклонить ее (можно принять альтернативную гипотезу, но нельзя принять нулевую гипотезу).</p>
<p>Некорректно говорить “достоверность” вместо статистической значимости, потому что в математике достоверное событие — то, которое происходит со 100% вероятностью. Про термин “достоверность” почитать можно дискуссию в чате, начиная с этого <a href="https://t.me/chat_biostat_R/10315" target="_blank">сообщения</a>, и поиском по чату можно найти достаточно аргументации, почему это нельзя использовать как замену статистической значимости.</p>
<p>И еще <a href="https://cyberleninka.ru/article/n/dostovernost-ili-statisticheskaya-znachimost-12-let-spustya" target="_blank">статья</a> на эту тему: <em>«Достоверность» или «Статистическая значимость» 12 лет спустя</em>, Зорин Никита Александрович.</p>
</section>
<section id="выводы" class="level2">
<h2 class="anchored" data-anchor-id="выводы">Выводы</h2>
<p>Как уже отмечала выше, курс был актуален в свое время. В настоящий момент смотреть курс “Основы статистики” скорее не рекомендую, ниже предлагаю список хороших материалов:</p>
<p>Для удобства попробовала разбить на разные уровни</p>
<p>Junior:</p>
<ol type="1">
<li>Книга “Статистика и котики” Владимир Савельев</li>
<li>Книга “Статистика для всех” (Statistics in a nutshell) Сара Бослаф</li>
<li><a href="https://pozdniakov.github.io/tidy_stats/index.html" target="_blank">Анализ данных и статистика в R</a> Ивана Позднякова</li>
</ol>
<p>Middle:</p>
<ol type="1">
<li>Курс “<a href="https://varmara.github.io/linmodr/" target="_blank">Линейные модели, дисперсионный и регрессионный анализ с использованием R</a>” авторством Марины Варфоломеевой и Вадима Хайтова</li>
<li><a href="https://www.coursera.org/specializations/statistics" target="_blank">Курс Data Analysis with R Specialization</a> на курсере</li>
<li><a href="https://www.youtube.com/@statquest" target="_blank">StatQuest</a> - отличный канал с короткими, но очень четкими разборами конкретных тем по статистике.</li>
<li><a href="https://www.youtube.com/@tilestats" target="_blank">TileStats</a> - тоже очень хороший канал по статистике с похожим форматом.</li>
</ol>
<p>Senior:</p>
<ol type="1">
<li>Подборка Матвея Славенко в канале <a href="https://t.me/choking_data" target="_blank">душно про дату</a>: <a href="https://t.me/choking_data/51" target="_blank">первое</a>, <a href="https://t.me/choking_data/52" target="_blank">второе</a></li>
</ol>
<p>При этом всем хочу выразить Анатолию Карпову респект за популяризацию R в сообществе (по крайней мере раньше), и большую благодарность за бесплатные программы: <a href="https://karpov.courses/simulator-sql" target="_blank">симулятор SQL</a>, <a href="https://karpov.courses/datavisualization" target="_blank">курс по визуализации данных</a>.</p>
</section>
<section id="благодарности" class="level2">
<h2 class="anchored" data-anchor-id="благодарности">Благодарности</h2>
<p>Матвею Славенко за уточнение сложных моментов и помощь с корректностью формулировок, Яне, Жене и Юле за конструктивные статистические дискуссии и рекомендации по тексту, Сергею Матросову за дополнительную мотивацию все-таки дописать пост и Дмитрию Пензару за исходное развитие дискуссии и пример с ЦПТ.</p>
<p>Обсудить можно в телеграм-канале <a href="https://t.me/stats_for_science" target="_blank">Статистика и R в науке и аналитике</a>, в комментариях к <a href="https://t.me/stats_for_science/125" target="_blank">посту</a> или здесь, авторизовавшись через GitHub.</p>
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/images/tlg_short.png" class="img-fluid"></p>


</section>

 ]]></description>
  <category>statistics</category>
  <guid>https://ubogoeva.github.io/R4Analytics/posts/review_of_statistics_course.html</guid>
  <pubDate>Thu, 13 Feb 2025 18:00:00 GMT</pubDate>
</item>
<item>
  <title>Тест Стьюдента и тест Велча</title>
  <dc:creator>Elena U</dc:creator>
  <link>https://ubogoeva.github.io/R4Analytics/posts/welch_test.html</link>
  <description><![CDATA[ 
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(97025960, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/97025960" style="position:absolute; left:-9999px;" alt=""></div></noscript>
<!-- /Yandex.Metrika counter -->





<p>Разберем недостатки схем по выбору статистических тестов, формулу теста Велча и сравним с помощью симуляций тест Стьюдента и тест Велча в разных условиях.</p>
<section id="проблема-дорожных-карт-по-статистике" class="level2">
<h2 class="anchored" data-anchor-id="проблема-дорожных-карт-по-статистике">Проблема дорожных карт по статистике</h2>
<p>Наверняка каждый при проведении статистических тестов сталкивался с проблемой выбора подходящего теста. В научном сообществе есть определенная популярность у “дорожных карт” по выбору статистического метода, пример ниже:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://onishlab.colostate.edu/wp-content/uploads/2019/07/which_test_flowchart.png"><img src="https://onishlab.colostate.edu/wp-content/uploads/2019/07/which_test_flowchart.png" class="img-fluid figure-img" alt="Можно кликнуть на картинку и перейти на изображение в лучшем качестве"></a></p>
<figcaption>Можно кликнуть на картинку и перейти на изображение в лучшем качестве</figcaption>
</figure>
</div>
<p>Я выбрала первую попавшуюся схему по запросу <code>how to choose statistical test flow chart</code>, в этой схеме есть сразу несколько ошибок, например миф про 30 наблюдений (тут вообще странное, по мнению автора схемы, при размере выборки больше 30 наблюдений можно использовать z-test).</p>
<p>Обычно этот миф звучит так: для небольших выборок меньше 30 наблюдений для применения t-теста нужно, чтобы было нормальное распределение данных, а если наблюдений больше 30, то можно использовать t-тест и так, в силу центральной предельной теоремы. Почему это миф, написано в статье “<a href="https://koch-kir.medium.com/история-одного-обмана-или-требования-к-распределению-в-статистических-тестах-55139a5558d">История одного обмана или требования к распределению в t-тесте</a>”.<br>
Статья подвергалась определенной критике профильных статистиков, но ключевой момент отражен верно — для t-теста не нужно нормальное распределение <em>данных</em>, нужно нормальное распределение <em>тестовой статистики</em> — то есть выборочных средних. Про это подробно собирается написать статистик <strong>Матвей Славенко</strong>, я обязательно сделаю репост, когда статья выйдет, так как для сообщества очень нужен такой материал.</p>
<p>Но вернемся к тесту.</p>
</section>
<section id="тест-велча-теория" class="level2">
<h2 class="anchored" data-anchor-id="тест-велча-теория">Тест Велча: теория</h2>
<p>Часто для двухвыборочного независимого теста Стьюдента можно встретить требование к равенству дисперсий, и это правильное требование, если использовать классический тест Стьюдента. Однако в большинстве статистических пакетов, в том числе в R, реализован тест Стьюдента с поправкой Велча (Welch) или просто тест Велча, или тест Стьюдента для неравных дисперсий (t-test for unequal variances), для которого нет требования по соблюдению равенства дисперсий.</p>
<p>И многие авторы рекомендуют использовать именно его, вне зависимости от равенства дисперсий. Давайте разберемся, так ли это.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Примечание
</div>
</div>
<div class="callout-body-container callout-body">
<p>Здесь и далее формулировка “тест Стьюдента” будет означать двухвыборочный независимый тест Стьюдента без поправки Велча.</p>
<p>Тест Велча - тест Стьюдента с поправкой Велча.</p>
</div>
</div>
<p>Формула вычисления t-статистики теста Стьюдента:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0At%20=%20%5Cfrac%7B%5Coverline%7BX_1%7D-%5Coverline%7BX_2%7D%7D%7Bs_x%5Csqrt%7B%5Cfrac%7B1%7D%7Bn_1%7D%20+%20%5Cfrac%7B1%7D%7Bn_2%7D%7D%7D,%0As_x%20=%20%5Csqrt%7B%5Cfrac%7B(n_1%20-%201)s_1%5E2%20+%20(n_2%20-%201)s_2%5E2%7D%7Bn_1%20+%20n_2%20-%202%7D%7D%0A"></p>
<p>Чтобы запустить именно тест Стьюдента в R, можно использовать аргумент <code>var.equal = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.equal =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two Sample t-test

data:  rnorm(100, mean = 0, sd = 1) and rnorm(100, mean = 0, sd = 1)
t = -1.1878, df = 198, p-value = 0.2363
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.4285169  0.1063450
sample estimates:
  mean of x   mean of y 
-0.10910933  0.05197663 </code></pre>
</div>
</div>
<p>Однако это делать не рекомендуется, поскольку при равных дисперсиях тест Стьюдента не будет сильно отличаться от теста Велча, а при разных тест Велча точнее.</p>
<p>Формула теста Велча:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0At%20=%20%5Cfrac%7B%5Coverline%7BX%7D_1%20-%20%5Coverline%7BX%7D_2%7D%7B%5Csqrt%7B%5Cfrac%7Bs_1%5E2%7D%7Bn_1%7D%20+%20%5Cfrac%7Bs_2%5E2%7D%7Bn_2%7D%7D%7D%0A"></p>
<p>Количество степеней свободы:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Adf%20=%20%5Cfrac%7B(s_1%5E2/n_1%20+%20s_2%5E2%20/%20n_2)%5E2%7D%7B(s_1%5E2/n_1)%5E2/(n_1-1)%20+%20(s_2%5E2/n_2)%5E2/(n_2-1)%7D%0A"></p>
<p>Для обучения мне проще начать рассказ с теста Стьюдента без поправки Велча, потому что на нем удобно посчитать вручную тестовую статистику и степени свободы. Однако потом обязательно уточняю, что рекомендуется использовать тест Велча, преимущество которого в необязательности требования равенства дисперсий.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Оффтоп
</div>
</div>
<div class="callout-body-container callout-body">
<p>При этом в источниках о тесте Стьюдента очень часто можно встретить требование к равенству дисперсий, как и к нормальности распределения исходных данных.</p>
<p>Но наиболее критичным требованием для проведения теста Стьюдента является независимость наблюдений.</p>
</div>
</div>
<p>Давайте разберем с помощью симуляций, как работает тест Велча и тест Стьюдента в разных ситуациях.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># загрузим тайдиверс</span></span></code></pre></div>
</div>
<p>Разберем разные кейсы: проверим и ошибку первого рода, и мощность теста при равных и разных дисперсиях, и в зависимости от равенства объемов выборок.</p>
</section>
<section id="отличий-нет-проверка-на-ошибку-первого-рода" class="level2">
<h2 class="anchored" data-anchor-id="отличий-нет-проверка-на-ошибку-первого-рода">Отличий нет, проверка на ошибку первого рода</h2>
<section id="одинаковое-среднее-и-дисперсия-равный-размер-выборок" class="level3">
<h3 class="anchored" data-anchor-id="одинаковое-среднее-и-дисперсия-равный-размер-выборок">Одинаковое среднее и дисперсия, равный размер выборок</h3>
<p>Начнем с ситуации, когда у нас обе выборки из генеральных совокупностей с одинаковым средним и дисперсией, например, здесь это нормальное распределение со средним 0.2 и стандартным отклонением 1.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Примечание
</div>
</div>
<div class="callout-body-container callout-body">
<p>Здесь и в дальнейшем для симуляций будет создаваться генеральная совокупность (размером 100000) с заданными параметрами среднего и стандартного отклонения, а далее будут многократно извлекаться “выборки” заданного размера. Таким образом будет соблюдаться общая логика статистического вывода — наличие генеральной совокупности с заданными параметрами и извлечение выборок.</p>
</div>
</div>
<p>Для всех тестов в приведенных ниже расчетах зафиксировали уровень значимости <img src="https://latex.codecogs.com/png.latex?%5Calpha=0.05">.</p>
<p><strong>Тест Велча</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">population <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># создание генеральной совокупности</span></span>
<span id="cb4-2">p_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-3">                              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb4-4">                            population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-5">                              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value)</span>
<span id="cb4-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(p_values, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Распределение p-value для теста Велча'</span>,</span>
<span id="cb4-7">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sub =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Равные средние, равные дисперсии'</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/welch_test_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(p_values <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># доля p-value, которые оказались меньше 0.05 (прокрасились) </span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.034</code></pre>
</div>
</div>
<p><strong>Тест Стьюдента</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">p_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-2">                              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb7-3">                            population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-4">                              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb7-5">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.equal =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value)</span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(p_values, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Распределение p-value для теста Стьюдента'</span>,</span>
<span id="cb7-7">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sub =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Равные средние, равные дисперсии'</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/welch_test_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(p_values <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># доля p-value, которые оказались меньше 0.05 (прокрасились)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.04</code></pre>
</div>
</div>
<p>Здесь у нас вероятность ошибки первого рода для обоих тестов примерно 0.05, а также распределение p-value похоже на равномерное. Это ожидаемо и корректно, так как выборки извлекались из одинаковой генеральной совокупности, а значит, что доля ложноположительных результатов (=прокрасов) должна быть не больше заданного уровня <img src="https://latex.codecogs.com/png.latex?%5Calpha%20=%200.05">.</p>
</section>
<section id="одинаковое-среднее-разная-дисперсия-равный-размер-выборок" class="level3">
<h3 class="anchored" data-anchor-id="одинаковое-среднее-разная-дисперсия-равный-размер-выборок">Одинаковое среднее, разная дисперсия, равный размер выборок</h3>
<p>Теперь рассмотрим случай с неравными дисперсиями. Для этого создадим две генеральные совокупности с одинаковым средним, но в одной стандартное отклонение 1, в другой 2. Извлекаем две выборки размером 10000 значений и сравниваем их тестом Стьюдента и тестом Велча.</p>
<p><strong>Тест Велча</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">population1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># создание первой генеральной совокупности</span></span>
<span id="cb10-2">population2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># создание второй генеральной совокупности</span></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># проведение теста</span></span>
<span id="cb10-4">p_values_welch <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(population1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-5">                                      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb10-6">                                    population2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-7">                                      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value)</span>
<span id="cb10-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(p_values_welch, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Распределение p-value для теста Велча'</span>,</span>
<span id="cb10-9">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sub =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Равные средние, разные дисперсии'</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/welch_test_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(p_values_welch <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0396</code></pre>
</div>
</div>
<p><strong>Тест Стьюдента</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># проведение теста</span></span>
<span id="cb13-2">p_values_st <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(population1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-3">                                      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb13-4">                                    population2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-5">                                      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb13-6">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.equal =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value)</span>
<span id="cb13-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(p_values_st, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Распределение p-value для теста Стьюдента'</span>,</span>
<span id="cb13-8">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sub =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Равные средние, разные дисперсии'</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/welch_test_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(p_values_st <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0416</code></pre>
</div>
</div>
<p>Здесь выводы те же самые, как в предыдущем случае. Хоть и дисперсия в генеральных совокупностях разная, оба теста сохраняют долю ошибки первого рода на нужном уровне (меньше 0.05).<br>
Тут важно указать, что размер выборок в данном примере одинаковый. Однако тест Стьюдента без поправки Велча становится неустойчивым с точки зрения ошибки первого рода, в случае, когда у нас выборки сильно отличаются по размеру.</p>
</section>
<section id="одинаковое-среднее-разная-дисперсия-разный-размер-выборок" class="level3">
<h3 class="anchored" data-anchor-id="одинаковое-среднее-разная-дисперсия-разный-размер-выборок">Одинаковое среднее, разная дисперсия, разный размер выборок</h3>
<p>Например, в выборке с большей дисперсией 3000 наблюдений, в выборке с меньшей дисперсией 7000 наблюдений.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Примечание
</div>
</div>
<div class="callout-body-container callout-body">
<p>Здесь я написала так для краткости, имелось ввиду: выборки, извлеченные из генеральной совокупности с <strong>большей</strong> дисперсией, содержат 3000 наблюдений, а выборки, извлеченные из генеральной совокупности с <strong>меньшей</strong> дисперсией, содержат 7000 наблюдений.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Пример
</div>
</div>
<div class="callout-body-container callout-body">
<p>Такая ситуация может встретиться в A/B тестировании, когда для 30% пользователей мы показываем тестовую версию, а контрольную версию видят 70% пользователей.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Тест Велча</span></span>
<span id="cb16-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(population1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-3">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb16-4">                             population2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-5">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0489</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Тест Стьюдента</span></span>
<span id="cb18-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(population1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-3">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb18-4">                             population2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-5">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb18-6">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.equal =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1201</code></pre>
</div>
</div>
<p>Получилось, что тест Стьюдента в ситуации с неравными дисперсиями и разным размером выборки показал себя хуже и мы наблюдали ложные прокрасы в 12% случаев (вместо 5%, как должно было бы быть).</p>
<p>С увеличением дисбаланса в размере выборок, ситуация становится хуже, например, вот что произойдет, если выборки отличаются по размеру в 9 раз (тоже может встретиться в A/B тестировании, пример, что это часто используемая практика по <a href="https://developers.is.com/ironsource-mobile/air/best-practices-monetization-ab-testing/#step-1">ссылке</a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># тест Велча</span></span>
<span id="cb20-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(population1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb20-3">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb20-4">                             population2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb20-5">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># тест Стьюдента</span></span>
<span id="cb22-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(population1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-3">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb22-4">                             population2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-5">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb22-6">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.equal =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2406</code></pre>
</div>
</div>
<p>Тут для теста Стьюдента без поправки Велча получилось <strong>24%</strong> ложноположительных результатов! Это очень много относительно заданного уровня <img src="https://latex.codecogs.com/png.latex?%5Calpha=0.05">. Получается, что мы будем находить значимые отличия почти в четверти случаев, и принимать неверные решения. Тест Велча при этом сохраняет долю ложноположительных результатов на уровне 5%, как и должно быть.</p>
<p>Для выборок разного размера при увеличении неравенства дисперсий наблюдается дальнейшее ухудшение работы теста Стьюдента (в ситуации, когда меньшая выборка с большей дисперсией).</p>
<p>Давайте построим график зависимости ошибки первого рода от неравенства дисперсий в выборке, где размер выборок отличается в 9 раз, при этом меньшая выборка с большей дисперсией.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">var_size <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb24-2">calculate_mean_error_1st_type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x, var.equal) {</span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, </span>
<span id="cb24-4">                 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb24-5">                        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>x), </span>
<span id="cb24-6">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.equal =</span> var.equal)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span>
<span id="cb24-7">}</span>
<span id="cb24-8">welch_error_1st_type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(var_size, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calculate_mean_error_1st_type</span>(., <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))</span>
<span id="cb24-9">students_error_1st_type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(var_size, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calculate_mean_error_1st_type</span>(., <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb24-10"></span>
<span id="cb24-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(var_size, welch_error_1st_type, students_error_1st_type) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(welch_error_1st_type, students_error_1st_type), </span>
<span id="cb24-13">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'error_1st_type'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(var_size, error_1st_type))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> type))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> type))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Разница в стандартном отклонении между выборками'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Вид теста'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'тест Стьюдента'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'тест Велча'</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Доля ошибки первого рода'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Зависимость ошибки первого рода от стандартного отклонения'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'меньшая выборка с большей дисперсией'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb24-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/welch_test_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>При таком дисбалансе выборок, чем больше разница в дисперсии, тем хуже работает тест Стьюдента.</p>
<p>Проверим, что будет, если наоборот, большая выборка будет с большей дисперсией.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">var_size <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb25-2">calculate_mean_error_1st_type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x, var.equal) {</span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, </span>
<span id="cb25-4">                 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb25-5">                        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>x), </span>
<span id="cb25-6">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.equal =</span> var.equal)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span>
<span id="cb25-7">}</span>
<span id="cb25-8">welch_error_1st_type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(var_size, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calculate_mean_error_1st_type</span>(., <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))</span>
<span id="cb25-9">students_error_1st_type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(var_size, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calculate_mean_error_1st_type</span>(., <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb25-10"></span>
<span id="cb25-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(var_size, welch_error_1st_type, students_error_1st_type) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(welch_error_1st_type, students_error_1st_type), </span>
<span id="cb25-13">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'error_1st_type'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(var_size, error_1st_type))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> type))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> type))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Разница в стандартном отклонении между выборками'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Вид теста'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'тест Стьюдента'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'тест Велча'</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Доля ошибки первого рода'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Зависимость ошибки первого рода от стандартного отклонения'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'большая выборка с большей дисперсией'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/welch_test_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Здесь тест Стьюдента работает даже лучше, доля ложноположительных результатов очень низкая. Но и тест Велча работает нормально, сохраняя ее на уровне примерно 0.05.</p>
<p>При этом при равных размерах выборок, разница в дисперсиях не влияет на оба теста.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">var_size <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb26-2">calculate_mean_error_1st_type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x, var.equal) {</span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>x), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.equal =</span> var.equal)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span>
<span id="cb26-4">}</span>
<span id="cb26-5">welch_error_1st_type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(var_size, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calculate_mean_error_1st_type</span>(., <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))</span>
<span id="cb26-6">students_error_1st_type <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(var_size, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calculate_mean_error_1st_type</span>(., <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb26-7"></span>
<span id="cb26-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(var_size, welch_error_1st_type, students_error_1st_type) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb26-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(welch_error_1st_type, students_error_1st_type), </span>
<span id="cb26-10">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'error_1st_type'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb26-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(var_size, error_1st_type))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> type))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> type))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Разница в стандартном отклонении между выборками'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Вид теста'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'тест Стьюдента'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'тест Велча'</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Доля ошибки первого рода'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Зависимость ошибки первого рода от стандартного отклонения'</span>, </span>
<span id="cb26-18">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'для теста Стьюдента и теста Велча для равных выборок'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/welch_test_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Таким образом, при одинаковом размере выборок, тест Стьюдента устойчив к нарушению предположения о равенстве дисперсий. Однако, в ситуации, когда выборки разного размера, причем большая выборка с меньшей дисперсией, тест Стьюдента начинает завышать ошибку первого рода.</p>
<p>Поэтому наиболее надежно будет использовать тест Велча в любом случае, вне зависимости от равенства дисперсий и размера выборок, так как он сохраняет ошибку первого рода на заданном уровне <img src="https://latex.codecogs.com/png.latex?%5Calpha"> .</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Оффтоп
</div>
</div>
<div class="callout-body-container callout-body">
<p>Кстати, и у теста Манна-Уитни не все хорошо в таком примере</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wilcox.test</span>(population1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-2">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb27-3">                             population2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-4">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.129</code></pre>
</div>
</div>
</div>
</div>
<p>Теперь рассмотрим как поведут себя тесты, в случае, когда отличия действительно есть.</p>
</section>
</section>
<section id="отличия-есть-проверка-на-мощность-теста" class="level2">
<h2 class="anchored" data-anchor-id="отличия-есть-проверка-на-мощность-теста">Отличия есть, проверка на мощность теста</h2>
<section id="разное-среднее-одинаковая-дисперсия-равный-размер-выборок" class="level3">
<h3 class="anchored" data-anchor-id="разное-среднее-одинаковая-дисперсия-равный-размер-выборок">Разное среднее, одинаковая дисперсия, равный размер выборок</h3>
<p>Начнем с ситуации, когда извлекаем выборки из двух генеральных совокупностей с <strong>разным</strong> средним и <strong>равной</strong> дисперсией.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">pop1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb29-2">pop2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb29-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pop1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-4.4529 -0.4758  0.1953  0.1967  0.8738  4.4452 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pop2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-4.1232 -0.3741  0.2974  0.2967  0.9762  4.7235 </code></pre>
</div>
</div>
<p>Визуализируем полученные выборки, пунктиром показано среднее.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sample1 =</span> pop1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb33-2">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sample2 =</span> pop2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb33-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb33-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(sample1, sample2)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb33-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> name))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>name, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> ..x.., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), </span>
<span id="cb33-9">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vline"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orientation =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/welch_test_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Проверим работу тестов:</p>
<p><strong>Тест Велча:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">p_value <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(pop1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb34-2">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb34-3">                             pop2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb34-4">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value)</span>
<span id="cb34-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(p_value)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/welch_test_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p><strong>Тест Стьюдента:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">p_value <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(pop1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb37-2">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb37-3">                             pop2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb37-4">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb37-5">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.equal =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value)</span>
<span id="cb37-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(p_value)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/welch_test_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(p_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>Оба теста нашли отличия там, где они есть в 100% случаев, что говорит о высокой мощности тестов, даже если отличия не очень большие (тут размер выборки примерно как в A/B тестировании, в биологии выборки будут поменьше).</p>
<p>Попробуем добавить неравенство дисперсий.</p>
</section>
<section id="разное-среднее-разная-дисперсия-равный-размер-выборок" class="level3">
<h3 class="anchored" data-anchor-id="разное-среднее-разная-дисперсия-равный-размер-выборок">Разное среднее, разная дисперсия, равный размер выборок</h3>
<p>Среднее отличается, и еще стандартное отклонение в одной из выборок выше на 2.</p>
<p>Проверим работу тестов:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">pop1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># создание генеральной совокупности</span></span>
<span id="cb40-2">pop2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># создание генеральной совокупности</span></span>
<span id="cb40-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(pop1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb40-4">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb40-5">                             pop2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb40-6">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9166</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(pop1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb42-2">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb42-3">                             pop2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb42-4">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>),</span>
<span id="cb42-5">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.equal =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9145</code></pre>
</div>
</div>
<p>При равных размерах выборок оба теста хорошо справляются с неравенством дисперсий. Мощность теста больше 80% в обоих случаях.</p>
<p>Еще немного усложним и рассмотрим в ситуации с разным размером выборок.</p>
</section>
<section id="разное-среднее-разная-дисперсия-разный-размер-выборок" class="level3">
<h3 class="anchored" data-anchor-id="разное-среднее-разная-дисперсия-разный-размер-выборок">Разное среднее, разная дисперсия, разный размер выборок</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">pop1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb44-2">pop2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb44-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pop1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-4.7231 -0.4747  0.1995  0.1985  0.8761  4.2265 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pop2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-7.6160 -1.0539  0.3081  0.3019  1.6534  9.5586 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># тест Велча</span></span>
<span id="cb48-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(pop1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb48-3">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb48-4">                             pop2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb48-5">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9355</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># тест Стьюдента</span></span>
<span id="cb50-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(pop1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb50-3">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb50-4">                             pop2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb50-5">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>),</span>
<span id="cb50-6">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.equal =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8315</code></pre>
</div>
</div>
<p>Здесь тест Велча показал себя несколько лучше, но оба теста корректно находят отличия там, где они есть.</p>
<p>Проверим, что будет, если поменять местами выборки, чтобы в меньшей выборке была бОльшая дисперсия.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># тест Велча</span></span>
<span id="cb52-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(pop1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb52-3">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb52-4">                             pop2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb52-5">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7768</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># тест Стьюдента</span></span>
<span id="cb54-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(pop1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb54-3">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>), </span>
<span id="cb54-4">                             pop2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb54-5">                               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>),</span>
<span id="cb54-6">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.equal =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8785</code></pre>
</div>
</div>
<p>Оба теста показали хороший результат в этом случае, возможно даже тест Стьюдента немного лучше.</p>
</section>
</section>
<section id="выводы" class="level2">
<h2 class="anchored" data-anchor-id="выводы">Выводы</h2>
<p>В большинстве случаев оба теста контролируют ошибку первого рода и мощность на заданном уровне. Однако у теста Стьюдента есть проблема с ошибкой первого рода (ложноположительные результаты) в ситуации с неравными дисперсиями и разным размером выборок.</p>
<table class="caption-top table">
<caption>Здесь ✅ — тест показал себя хорошо, ❌ — тест показал себя плохо, 🟡 — тест показал себя не оптимально, но не слишком плохо</caption>
<colgroup>
<col style="width: 75%">
<col style="width: 10%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>тест Велча</th>
<th>тест Стьюдента</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Отличий нет, равные дисперсии, равные выборки</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr class="even">
<td>Отличий нет, разные дисперсии, равные выборки</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr class="odd">
<td>Отличий нет, разные дисперсии, разные выборки, меньшая выборка с большей дисперсией</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr class="even">
<td>Отличий нет, разные дисперсии, разные выборки, бОльшая выборка с большей дисперсией</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr class="odd">
<td>Отличия есть, равные дисперсии, равные выборки</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr class="even">
<td>Отличия есть, разные дисперсии, равные выборки</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr class="odd">
<td>Отличия есть, разные дисперсии, разные выборки, меньшая выборка с большей дисперсией</td>
<td>🟡</td>
<td>✅</td>
</tr>
<tr class="even">
<td>Отличия есть, разные дисперсии, разные выборки, бОльшая выборка с большей дисперсией</td>
<td>✅</td>
<td>🟡</td>
</tr>
</tbody>
</table>
<p>Поэтому рекомендация использовать тест Велча вне зависимости от дисперсий остается актуальной.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Что можно еще изучить:
</div>
</div>
<div class="callout-body-container callout-body">
<p>В этом материале не рассмотрела, что будет при небольших размерах выборок, проверила только часть из разобранных кейсов. В плане ошибки первого рода выводы не меняются на малых выборках, а вот для оценки мощности нужно реализовать более сильные эффекты, так как на малых выборках не хватает мощности обоих тестов.</p>
<p>Возможно, вынесу разбор этого в отдельный пост, так как здесь уже и так информации достаточно много.</p>
</div>
</div>
<p>Подписывайтесь на <a href="https://t.me/stats_for_science">телеграм-канал</a>, кто еще этого не сделал, пишите комментарии в телеграме или здесь!</p>
<p><img src="https://ubogoeva.github.io/R4Analytics/images/logo_final_tlg.png" class="img-fluid"></p>


</section>

 ]]></description>
  <category>statistics</category>
  <guid>https://ubogoeva.github.io/R4Analytics/posts/welch_test.html</guid>
  <pubDate>Sat, 23 Nov 2024 18:00:00 GMT</pubDate>
</item>
<item>
  <title>Решение контеста самокат</title>
  <dc:creator>Elena U</dc:creator>
  <link>https://ubogoeva.github.io/R4Analytics/posts/contest_samokat.html</link>
  <description><![CDATA[ 
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(97025960, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/97025960" style="position:absolute; left:-9999px;" alt=""></div></noscript>
<!-- /Yandex.Metrika counter -->





<section id="продуктовые-вопросы" class="level2">
<h2 class="anchored" data-anchor-id="продуктовые-вопросы">Продуктовые вопросы</h2>
<section id="как-определить-какой-продавец-мошенник-а-какой-нет-какие-ещё-могут-быть-схемы-мошенничества" class="level3">
<h3 class="anchored" data-anchor-id="как-определить-какой-продавец-мошенник-а-какой-нет-какие-ещё-могут-быть-схемы-мошенничества">Как определить, какой продавец мошенник, а какой — нет? Какие ещё могут быть схемы мошенничества?</h3>
<p>Мы можем предположить, что продавец мошенник по следующим признакам:</p>
<ol type="1">
<li>Нереалистично низкая цена на товар (например, скидка больше 30% относительно рыночной цены товаров или больше 2 сигм относительно таких же товаров от других продавцов).</li>
<li>Аккаунт продавца недавно создан, с большим количеством дорогих товаров (особенно в сочетании с первым пунктом о слишком большой скидке на них).</li>
<li>Недостаточно много отзывов о продавце (но это будет у любого недавно зарегистрировавшегося продавца).</li>
<li>Если зафиксированы попытки продавца общаться с покупателем вне площадки (можно установить при анализе общения во внутреннем мессенджере платформы).</li>
<li>Использование данных ИНН, которые уже использовались на площадке.</li>
<li>Нетипичное поведение после регистрации, аномальная динамика роста количества заказов</li>
</ol>
<p>Весьма вероятно, что модель машинного обучения будет обучена на этих и других признаках для определения мошенников.</p>
<p>Другие возможные схемы мошенничества:</p>
<ol type="1">
<li>Продажа поддельных товаров известных брендов.</li>
<li>Регистрация нескольких пользовательских аккаунтов мошенника, где происходит накрутка истории заказов и повышение рейтинга мошенника.</li>
<li>Фишинговые ссылки, где покупатель переходит на подставной сайт и у него воруют личные данные и данные банковских карт.</li>
<li>“Схема с предоплатой”. Мошенник требует предоплату за товар и после ее получения пропадает, товар оказывается не выслан, и мошенник был зарегистрирован не под своим именем (данные продавца украдены из слитых баз).</li>
<li>Фишинговые электронные письма с “выгодными” предложениями, которые маскируются под настоящие письма от маркетплейса, но ведут не на тот сайт, который будет красть данные банковских карт.</li>
</ol>
<p>Для борьбы с мошенниками можно использовать как автоматические системы (ML модели), так и ручной контроль (модерацию объявлений, проверку продавцов и товаров).</p>
</section>
<section id="какие-продуктовые-фичи-могут-помочь-нашим-клиентам-избежать-неприятных-ситуаций-с-мошенничеством" class="level3">
<h3 class="anchored" data-anchor-id="какие-продуктовые-фичи-могут-помочь-нашим-клиентам-избежать-неприятных-ситуаций-с-мошенничеством">Какие продуктовые фичи могут помочь нашим клиентам избежать неприятных ситуаций с мошенничеством?</h3>
<ol type="1">
<li>Система рейтинга и отзывов: Позволяет покупателям делиться своим опытом и оценивать продавцов. При этом, должна быть возможность проверки и модерации отзывов, чтобы предотвратить их фальсификацию.</li>
<li>Тщательная проверка продавцов. Например, при активации продавца требовать скан паспорт и селфи с паспортом с листом, где написана текущая дата и сервис, чтобы подтвердить личность продавца. Такая система верификации реализована в <a href="https://lightdoc.io/ru">LightDoc</a>. В итоге, если продавец оказался мошенником, то есть его документы и фотография, а селфи с указанием текущей даты защищает от использования слитых баз данных с паспортными данными.</li>
<li>Безопасная сделка со стороны маркетплейса. Покупатель переводит деньги на специальный счет маркетплейса, и они перечисляются продавцу только после того, как покупатель подтвердил получение товара (как в p2p криптовалютных биржах).</li>
<li>Чат на платформе: Все общение между продавцом и покупателем происходит внутри платформы. Это позволяет контролировать переписку и предотвратить попытки мошенничества. Например, так реализовано в <a href="https://www.avito.ru/">Avito</a>.</li>
<li>Автоматический анализ объявлений: Использование AI для анализа объявлений и выявления подозрительных. Например, если цена товара сильно отличается от среднерыночной (больше чем на 2 сигмы), объявление может быть автоматически помечено как подозрительное.</li>
<li>Возможность жалобы на продавца: Покупатели должны иметь возможность быстро и легко отправить жалобу на продавца, если они считают, что стали жертвами мошенничества.</li>
<li>Информационная поддержка: Разъяснение клиентам о типичных схемах мошенничества и о том, как себя вести в таких ситуациях.</li>
<li>Скрытие контактных данных покупателя.</li>
</ol>
</section>
<section id="через-какую-механику-мошенник-узнает-контакты-покупателя-что-можем-сделать-чтобы-усложнить-жизнь-фродерам" class="level3">
<h3 class="anchored" data-anchor-id="через-какую-механику-мошенник-узнает-контакты-покупателя-что-можем-сделать-чтобы-усложнить-жизнь-фродерам">Через какую механику мошенник узнает контакты покупателя? Что можем сделать, чтобы усложнить жизнь фродерам?</h3>
<p>На большинстве площадок контактные данные покупателя становятся доступны продавцу после оформления заказа. Мошенник может также попытаться узнать контакты покупателя, предлагая ему общаться вне платформы, например, через личные сообщения, электронную почту или телефон.</p>
<p>Чтобы усложнить жизнь фродерам, можно предпринять следующие шаги:</p>
<ol type="1">
<li>Скрыть контактные данные покупателя и использовать алгоритм подмены номера с переадресацией. Таким образом, фродер не сможет написать напрямую в мессенджер whatsapp или telegram. При звонках будет озвучиваться предупреждение, что это звонок от маркетплейса.</li>
<li>Рекомендовать покупателям и продавцам использовать только внутреннюю систему сообщений. Это поможет защитить личные данные пользователей, и позволит модераторам отслеживать возможные попытки мошенничества.</li>
<li>Предупреждение пользователей: Информировать пользователей о рисках, связанных с предоставлением своих контактных данных третьим лицам.</li>
<li>Блокировка ссылок и контактов в сообщениях: В сообщениях между продавцом и покупателем можно запретить отправку ссылок и контактных данных.</li>
<li>Верификация продавцов: Проверять продавцов при регистрации, требуя подтверждения их личности и банковских реквизитов.</li>
<li>“Безопасная сделка”: Внедрение системы, при которой деньги переводятся продавцу только после подтверждения получения товара покупателем.</li>
<li>Использование алгоритмов машинного обучения для выявления подозрительной активности: Это может включать в себя анализ поведения пользователей и продавцов, анализ текста сообщений и так далее.</li>
<li>Быстрая блокировка и удаление аккаунтов, замеченных в мошенничестве.</li>
<li>Постоянное обновление и улучшение системы безопасности, регулярный мониторинг и анализ активности на платформе.</li>
</ol>
</section>
</section>
<section id="дизайн-ab-тестов" class="level2">
<h2 class="anchored" data-anchor-id="дизайн-ab-тестов">Дизайн A/B тестов</h2>
<section id="определите-основную-метрику-дополнительные-метрики-и-принцип-разделения-на-группы" class="level3">
<h3 class="anchored" data-anchor-id="определите-основную-метрику-дополнительные-метрики-и-принцип-разделения-на-группы">Определите основную метрику (дополнительные метрики) и принцип разделения на группы</h3>
<p>Из чата ответ на вопрос:</p>
<pre><code>Цель - поймать всех фродеров на этапе онбординга

Если правильно понял вопрос, то количество регистраций останется такое же, мы надеемся, что упадет количество активированных фродеров</code></pre>
<p>Далее терминологически группа с ML-моделью будет называться экспериментальная или B-группа, с ручным определением – контрольная (A-группа).</p>
<section id="определение-метрик" class="level4">
<h4 class="anchored" data-anchor-id="определение-метрик">Определение метрик</h4>
<p>Основные (core) метрики:</p>
<ul>
<li>Доля активированных фродеров. Ожидаем, что эта доля будет статистически значимо ниже в группе с ML-моделью по сравнению с ручным определением.</li>
</ul>
<p>Дополнительные прокси метрики:</p>
<ul>
<li><p>Количество жалоб от покупателей на мошенничество: ожидаем, что эта метрика как минимум не должна расти в экспериментальной группе, а лучше если снизится.</p></li>
<li><p>Среднее время выявления мошенника: ожидаем, что оно снизится в группе с применением модели (и не увеличится).</p></li>
</ul>
<p>Дополнительные warning метрики:</p>
<ul>
<li><p>Доля жалоб обычных мерчантов, которых незаслуженно заблокировали. Ожидаем, что эта метрика не начнет расти.</p></li>
<li><p>Среднее время продавца на прохождение активации: не должно увеличиться в экспериментальной группе.</p></li>
<li><p>Количество возвратов средств: не должно быть выше в экспериментальной группе</p></li>
</ul>
</section>
<section id="принцип-разделения-на-группы" class="level4">
<h4 class="anchored" data-anchor-id="принцип-разделения-на-группы">Принцип разделения на группы</h4>
<p>У нас неравномерно распределение мерчантов по типу бизнеса: <code>25200</code> наблюдений с типом IE (индивидуальный предприниматель) и <code>9800</code> с типом LLC (общество с ограниченной ответственностью). Кроме этого, распределение доли выявленных мошенников тоже неравномерно:</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">0</th>
<th style="text-align: right;">1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">IE</td>
<td style="text-align: right;">22330</td>
<td style="text-align: right;">2374</td>
</tr>
<tr class="even">
<td style="text-align: left;">LLC</td>
<td style="text-align: right;">9142</td>
<td style="text-align: right;">454</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/contest_samokat_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>Если посчитать тест хи-квадрат, чтобы сравнить пропорции фродеров в разных типах бизнеса, то окажется, что они статистически значимо различаются, p-value порядка <code>4.51e-49</code>, следовательно при сплитовании групп для A/B теста нам критически важно сбалансировать долю типов бизнеса.</p>
<p>Сделать это можно следующим образом: сначала рассчитать пропорцию продавцов каждого вида бизнеса</p>
<ul>
<li><p>Для IE: <code>25200 / (25200 + 9800) = 0.72</code> (72% всех продавцов)</p></li>
<li><p>Для LLC: <code>9800 / (25200 + 9800) = 0.28</code> (28% всех продавцов)</p></li>
</ul>
<p>Далее после расчета необходимого количества продавцов рассчитаем деление на группы.</p>
</section>
</section>
<section id="рассчитайте-какой-эффект-можно-статистически-значимо-отследить.-укажите-его" class="level3">
<h3 class="anchored" data-anchor-id="рассчитайте-какой-эффект-можно-статистически-значимо-отследить.-укажите-его">Рассчитайте, какой эффект можно статистически значимо отследить. Укажите его</h3>
<p>Зафиксируем значение <img src="https://latex.codecogs.com/png.latex?%5Calpha%20=%200.05"> для уровня значимости и <img src="https://latex.codecogs.com/png.latex?%5Cbeta%20=%200.8%25"> для уровня мощности.</p>
<p>Обратимся к историческим данным, которые у нас есть.</p>
<p>На данный момент по этим данным доля фродеров среди <em>активированных</em> пользователей:</p>
<pre><code>1611 / (18290 + 1611) = 0.0809 ~ 8%</code></pre>
<p>Мы считаем для бизнеса значимым изменением, если удастся уменьшить долю до 6%. Следовательно, MDE = 8% - 6% = 2% = 0.02</p>
<p>Рассчитаем по формуле для z-теста необходимый размер выборки:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AN%20=%20%5Cfrac%7B2%5Csigma%5E2(z%5Cfrac%7B1-%5Calpha%7D%7B2%7D%20+%20z_%7B1-%5Cbeta%7D)%5E2%7D%7Bd_%7Bmin%7D%5E2%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0AN%20=%20%5Cfrac%7B2p(1-p)(z_%7B0.975%7D%20+%20z_%7B0.80%7D)%5E2%7D%7Bd_%7Bmin%7D%5E2%7D%20=%20%5Cfrac%7B(2*0.08*0.92)*(1.96+0.84)%5E2%7D%7B0.02%5E2%7D%20=%202876%0A"></p>
<p>Размер выборки получился 2876 человек с округлением, теперь необходимо рассчитать количество недель, в течение которых мы будем проводить A/B тест. Для этого будет опираться на известные данные.</p>
</section>
<section id="расчет-необходимого-количества-недель-проведения-теста" class="level3">
<h3 class="anchored" data-anchor-id="расчет-необходимого-количества-недель-проведения-теста">Расчет необходимого количества недель проведения теста</h3>
<p>Сначала необходимо исключить из данных продавцов, где <code>registration_date = 1970-01-01</code>. Скорее всего, это продавцы, которые зарегистировались до рассматриваемого в датасете периода, либо некорректные данные. Для расчета среднего количества регистраций в неделю такие наблюдения исключаем.</p>
<p>Сначала визуализируем полученные результаты, чтобы оценить сезонность в данных:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/contest_samokat_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="4200"></p>
</figure>
</div>
</div>
</div>
<p>Значительной сезонности в течение года не наблюдается, можно рассчитать среднее. Среднее количество регистраций продавцов в неделю получилось ~670. Чтобы набрать 2876 продавцов, нам нужно проводить тест 4.29 недели, с округлением до целого: 5 недель составит длительность проведения A/B теста.</p>
<p>С учетом неравномерности продавцов по типу бизнеса нужно сделать следующее сплитование:</p>
<ul>
<li><p>Количество IE: <code>2876*0.72 = 2070</code> продавец</p></li>
<li><p>Количество LLC: <code>2876*0.28 = 806</code> продавец</p></li>
</ul>
<p>Далее делим пополам: в контрольной и тестовой группе по 1035 продавцов типа IE, и 806 продавцов типа LLC.</p>
<p>Однако, поскольку эксперимент идет в течение недель, то нам нужно: когда будут приходить новые продавцы регистрироваться, назначать им случайным образом в контрольную или тестовую группу они попадут с приблизительным соблюдением пропорций 72% и 28%. Сделать это можно с помощью функций в python с обязательным сохранением сида случайности, чтобы иметь возможность воспроизвести разделение на группы. Далее, после того как сплитование проведено, нужно убедиться что нужные пропорции сохранились и доля родавцов IE и LLC в контрольной и тестовой группах остались примерно равными.</p>
<p>​</p>


</section>
</section>

 ]]></description>
  <category>analytics</category>
  <guid>https://ubogoeva.github.io/R4Analytics/posts/contest_samokat.html</guid>
  <pubDate>Tue, 28 May 2024 18:00:00 GMT</pubDate>
</item>
<item>
  <title>Как добавить яндекс-метрику на сайт Quarto</title>
  <dc:creator>Elena U</dc:creator>
  <link>https://ubogoeva.github.io/R4Analytics/posts/YandexMetricsQuarto.html</link>
  <description><![CDATA[ 
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(97025960, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/97025960" style="position:absolute; left:-9999px;" alt=""></div></noscript>
<!-- /Yandex.Metrika counter -->





<p>Всем привет!</p>
<p>В какой-то момент мне стало интересно, как работает яндекс-метрика для веб-аналитики, и я решила попробовать это сделать на своем сайте со статьями по R.</p>
<p>Пошаговая инструкция:</p>
<ol type="1">
<li><p>Для начала нужно создать счетчик на <a href="https://metrika.yandex.ru/list">сайте</a> метрики, вписать туда URL сайта, принять условия соглашения и тп.</p>
<p>Появится уникальный номер счетчика и код счетчика в JavaScript, который нужно добавить на сайт в пределах тегов &lt;head&gt;&lt;/head&gt; или &lt;body&gt;&lt;/body&gt;. Как это сделать в Quarto-сайте не было написано, но все оказалось очень просто и изящно.</p></li>
<li><p>Нужно сохранить вышеприведенный код счетчика в файл <code>.js</code> в директории проекта сайта например с названием <code>metrics.js</code>.</p></li>
<li><p>В файле <code>_quarto.yml</code>, где хранятся основные настройки сайта вписать:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb1-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb1-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">include-before-body</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> &lt;path_to_file/metrics.js&gt;</span></span></code></pre></div></li>
<li><p>Проверить, что счетчик установлен на странице метрики, если все сделано правильно, то по ссылке появится всплывающее окно о том, что счетчик активен.</p></li>
<li><p>Анализировать аналитику сайта.</p></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Google-analytics
</div>
</div>
<div class="callout-body-container callout-body">
<p>Google-аналитику можно было прикрепить на сайт относительно <a href="https://quarto.org/docs/websites/website-tools.html#google-analytics">нативным образом</a>, встроенным в Quarto.</p>
</div>
</div>



 ]]></description>
  <category>analytics</category>
  <guid>https://ubogoeva.github.io/R4Analytics/posts/YandexMetricsQuarto.html</guid>
  <pubDate>Mon, 15 Apr 2024 18:00:00 GMT</pubDate>
</item>
<item>
  <title>Поправки на множественное тестирование</title>
  <dc:creator>Elena U</dc:creator>
  <link>https://ubogoeva.github.io/R4Analytics/posts/multiple_testing.html</link>
  <description><![CDATA[ 
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(97025960, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/97025960" style="position:absolute; left:-9999px;" alt=""></div></noscript>
<!-- /Yandex.Metrika counter -->





<div style="text-align: right">
<p><em>Время чтения ~10 минут</em></p>
</div>
<p>Разберем, что такое поправки на множественное тестирование, зачем они нужны, как работают основные методы, которые часто используются в науке и индустрии, а также на что опираться при выборе поправки в своем исследовании.</p>
<p>Начнем разбор с классификации.</p>
<section id="классификация-поправок-на-множественное-тестирование" class="level2">
<h2 class="anchored" data-anchor-id="классификация-поправок-на-множественное-тестирование">Классификация поправок на множественное тестирование</h2>
<p>Существует 2 принципиально разных подхода к поправкам на множественное тестирование.</p>
<ul>
<li><p>Контроль групповой <strong>вероятности</strong> ошибки I рода (FWER, family-wise error rate)</p>
<ul>
<li><p>Тесты, которые поправляют значимость у набора p-value (поправка Бонферрони, Холма, Шидака и тд.) вне зависимости, какой тест был применен до этого;</p></li>
<li><p>Тесты для попарных сравнений групп: пост-хоки (поправка Тьюки, поправка Даннета, тест Фишера LSD и тд).</p></li>
</ul></li>
<li><p>Контроль <strong>доли</strong> ложных открытий (FDR, false discovery rate): поправка Benjamini-Hochberg, поправка Benjamini-Yekutieli.</p></li>
</ul>
<p>Небольшое напоминание про типы ошибок:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/images/error_1_2_type.jpg" class="img-fluid figure-img"></p>
<figcaption>https://t.me/stats_for_science/69</figcaption>
</figure>
</div>
<p>Разберем разные виды поправок подробнее.</p>
</section>
<section id="fwer-family-wise-error-rate" class="level1">
<h1>FWER – family-wise error rate</h1>
<p>FWER – групповая вероятность ошибки I рода. Мне больше нравится определение, что это вероятность совершить <strong>хоть одну</strong> ошибку первого рода в нескольких тестах. Обычно рассчитывается для серии тестов (но можно посчитать FWER и для одного теста: вероятность будет равна <img src="https://latex.codecogs.com/png.latex?%5Calpha">).</p>
<p><span id="eq-fwer"><img src="https://latex.codecogs.com/png.latex?%0AFWER%20=%201%20-%20(1-%5Calpha)%5Ek,%20%D0%B3%D0%B4%D0%B5%0A%5Ctag%7B1%7D"></span></p>
<p><em>k</em> - количество тестов, <img src="https://latex.codecogs.com/png.latex?%5Calpha"> - уровень значимости.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Для корректного применения формулы тесты должны быть <u>независимыми</u>.</p>
</div>
</div>
<p>Если это не так, то посчитать точный FWER можно с помощью симуляции, а по формуле вычисляется верхняя граница (то есть максимально возможное значение вероятности совершить ошибку I рода).</p>
<p>Пример ситуаций, когда тесты зависимы:</p>
<ul>
<li><p>Мы собрали две группы образцов и измерили у них 20 параметров. Тесты зависимы, поскольку пул образцов один и тот же для каждого измеренного параметра.</p></li>
<li><p>У нас 3 группы, делаем попарное сравнение каждой группы с каждой. Тесты зависимы, поскольку одна и та же группа участвует в двух тестах.</p></li>
</ul>
<p>Во многих ситуациях тесты являются зависимыми, тем не менее, при множественном тестировании даже для зависимых тестов ошибка первого рода превышает пороговое 0.05.</p>
<section id="симуляция-независимых-тестов-для-подсчета-fwer" class="level2">
<h2 class="anchored" data-anchor-id="симуляция-независимых-тестов-для-подсчета-fwer">Симуляция независимых тестов для подсчета FWER</h2>
<p>Генерируем заданное количество раз (5, 10, 50, 100) выборки размером 100 элементов из одной генеральной совокупности (стандартного нормального распределения) и сравниваем их t-тестом. Повторяем это 10000 раз, чтобы оценить долю случаев, где мы получили p-value &lt; 0.05 (ложнопозитивный результат).</p>
<p>Тесты независимые, поскольку каждый раз извлекаем новую выборку, следовательно, мы ожидаем увидеть результат, близкий к рассчитанному по формуле выше.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Для 5 тестов: '</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Для 5 тестов:  0.2257"</code></pre>
</div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?FWER%20=%201%20-%20(1-%5Calpha)%5Ek%20=%201%20-%20(1-0.05)%5E5%20=%200.226"></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Для 10 тестов: '</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Для 10 тестов:  0.4046"</code></pre>
</div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?FWER%20=%201%20-%20(1-%5Calpha)%5Ek%20=%201%20-%20(1-0.05)%20%5E%7B10%7D%20=%200.401"></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Для 50 тестов: '</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Для 50 тестов:  0.925"</code></pre>
</div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?FWER%20=%201%20-%20(1-%5Calpha)%5Ek%20=%201%20-%20(1-0.05)%20%5E%7B50%7D%20=%200.923"></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Для 100 тестов: '</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Для 100 тестов:  0.9938"</code></pre>
</div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?FWER%20=%201%20-%20(1-%5Calpha)%5Ek%20=%201%20-%20(1-0.05)%20%5E%7B100%7D%20=%200.994"></p>
<p>Действительно, при симуляции значения FWER сходятся с теоретически рассчитанными. Что можно сделать, чтобы избежать ошибок первого рода?</p>
</section>
<section id="поправка-бонферрони-bonferroni" class="level2">
<h2 class="anchored" data-anchor-id="поправка-бонферрони-bonferroni">Поправка Бонферрони (Bonferroni)</h2>
<p>Самый простой способ контролировать вероятность ошибки первого рода – это изменить критический уровень значимости <img src="https://latex.codecogs.com/png.latex?%5Calpha">.</p>
<p><span id="eq-fwer_bonf"><img src="https://latex.codecogs.com/png.latex?%20FWER%20=%201%20-%20(1-%5Cfrac%7B%5Calpha%7D%7Bk%7D)%5Ek,%20%20%5Ctag%7B2%7D"></span></p>
<p>Делим <img src="https://latex.codecogs.com/png.latex?%5Calpha"> на число тестов -&gt; получаем новый p-уровень значимости, ниже которого результаты будут считаться статистически значимыми.</p>
<p>Или умножаем каждое p-value на количество тестов, и если поправленное p-value &lt; 0.05, то результат считается статистически значимым.</p>
<p>При таком подходе мы контролируем вероятность совершить <em>хоть одну</em> ошибку первого рода на уровне 0.05, однако сильно завышаем вероятность ошибки <u>второго рода</u> (то есть не найти значимый эффект, где он на самом деле есть), следовательно, уменьшаем мощность теста.</p>
<p>Проверим FWER после поправки.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Для 5 тестов FWER по Бонферрони: '</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Для 5 тестов FWER по Бонферрони:  0.0491"</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Для 10 тестов FWER по Бонферрони: '</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Для 10 тестов FWER по Бонферрони:  0.0462"</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Для 50 тестов FWER по Бонферрони: '</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Для 50 тестов FWER по Бонферрони:  0.0476"</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Для 100 тестов FWER по Бонферрони: '</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Для 100 тестов FWER по Бонферрони:  0.0484"</code></pre>
</div>
</div>
<p>Да, мы контролируем FWER на заданном уровне 0.05.</p>
<p>Поправка Бонферрони используется редко, в основном в областях, где цена ошибок первого рода (ложнопозитивного результата) очень высока, например в исследованиях GWAS на человеке. В остальных случаях рекомендуют использовать менее консервативные поправки.</p>
</section>
<section id="поправка-холма-holm" class="level2">
<h2 class="anchored" data-anchor-id="поправка-холма-holm">Поправка Холма (Holm)</h2>
<p>Менее консервативная поправка. Метод часто называют “Бонферрони-Холма”, однако Карло Бонферрони не имел отношения к разработке этой формулы. Разберем на примере как работает.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">p_value <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.004</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.87</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.003</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.04</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.18</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.24</span>)</span></code></pre></div>
</div>
<p>Сортируем и ранжируем p-value по возрастанию, далее по формуле умножаем каждое p-value на <img src="https://latex.codecogs.com/png.latex?(m+1-rank)">, где <img src="https://latex.codecogs.com/png.latex?m"> - количество тестов, <img src="https://latex.codecogs.com/png.latex?rank"> - ранг p-value.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">pvalue</th>
<th style="text-align: right;">rank_pvalue</th>
<th style="text-align: left;">formula</th>
<th style="text-align: right;">result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">0.003*(6 + 1 - 1)</td>
<td style="text-align: right;">0.018</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">0.004*(6 + 1 - 2)</td>
<td style="text-align: right;">0.020</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.040</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">0.04*(6 + 1 - 3)</td>
<td style="text-align: right;">0.160</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.180</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">0.18*(6 + 1 - 4)</td>
<td style="text-align: right;">0.540</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.240</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">0.24*(6 + 1 - 5)</td>
<td style="text-align: right;">0.480</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.870</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">0.87*(6 + 1 - 6)</td>
<td style="text-align: right;">0.870</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Далее нужно задать, что поправленные p-value могут только возрастать, и при этом p-value заменяется на бОльшее, поэтому процедура поправки Холма называется пошаговой нисходящей – step-down.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">pvalue</th>
<th style="text-align: right;">rank_pvalue</th>
<th style="text-align: left;">formula</th>
<th style="text-align: right;">result</th>
<th style="text-align: right;">p_adjusted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">0.003*(6 + 1 - 1)</td>
<td style="text-align: right;">0.018</td>
<td style="text-align: right;">0.018</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">0.004*(6 + 1 - 2)</td>
<td style="text-align: right;">0.020</td>
<td style="text-align: right;">0.020</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.040</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">0.04*(6 + 1 - 3)</td>
<td style="text-align: right;">0.160</td>
<td style="text-align: right;">0.160</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.180</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">0.18*(6 + 1 - 4)</td>
<td style="text-align: right;">0.540</td>
<td style="text-align: right;">0.540</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.240</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">0.24*(6 + 1 - 5)</td>
<td style="text-align: right;">0.480</td>
<td style="text-align: right;">0.540</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.870</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">0.87*(6 + 1 - 6)</td>
<td style="text-align: right;">0.870</td>
<td style="text-align: right;">0.870</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Можем убедиться, что у нас подсчитано все верно:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">p.adjust</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(p_value), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'holm'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.018 0.020 0.160 0.540 0.540 0.870</code></pre>
</div>
</div>
<p>Поскольку для самого <strong>минимального</strong> <strong>p-value</strong> поправленное p-value <strong>такое же</strong> как и в Бонферрони, то поправка Холма контролирует FWER на <strong>том же уровне 0.05</strong>, что и поправка Бонферрони, при этом не так сильно снижает мощность тестов.</p>
<p>Проверим на 100 тестах:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">p.adjust</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'holm'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.059</code></pre>
</div>
</div>
<p>Таким образом, мы все еще контролируем вероятность совершить хоть одну ошибку первого рода на уровне 0.05, и оставляем больше значимых результатов, по сравнению с поправкой Бонферрони. Поэтому во многих случаях рекомендуют использовать именно поправку Холма для множественных сравнений.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ссылка на оригинальную статью:
</div>
</div>
<div class="callout-body-container callout-body">
<p>Holm, S. (1979). A simple sequentially rejective multiple test procedure. <em>Scandinavian Journal of Statistics</em>, <strong>6</strong>, 65–70. <a href="https://www.jstor.org/stable/4615733" class="uri">https://www.jstor.org/stable/4615733</a>.</p>
</div>
</div>
<p>Теперь перейдем к поправкам, которые используются в конкретных тестах.</p>
</section>
<section id="тест-фишера-lsd-least-significant-difference" class="level2">
<h2 class="anchored" data-anchor-id="тест-фишера-lsd-least-significant-difference">Тест Фишера LSD (Least significant difference)</h2>
<p>Используется как постхок тест <strong>только</strong> после значимой ANOVA для сравнения средних групп между собой (напоминаю, что ANOVA, дисперсионный анализ дает ответ на вопрос, есть ли хоть какое-то различие между группами, но не говорит между какими). Также тест можно применять <strong>только</strong> для сравнения <u>трех групп</u>.</p>
<p>Формула вычисления критерия:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0At%20=%20%5Cfrac%7B%5Coverline%7BX_1%7D-%5Coverline%7BX2%7D%7D%7B%5Csqrt%7BMSE(%5Cfrac%7B1%7D%7Bn_1%7D+%5Cfrac%7B1%7D%7Bn_2%7D)%7D%7D,%20%D0%B3%D0%B4%D0%B5%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Coverline%7BX_1%7D">, <img src="https://latex.codecogs.com/png.latex?%5Coverline%7BX_2%7D"> – средние групп 1 и 2, <img src="https://latex.codecogs.com/png.latex?n_1">, <img src="https://latex.codecogs.com/png.latex?n_2"> – размер групп 1 и 2, <img src="https://latex.codecogs.com/png.latex?MSE"> – mean square error из таблицы ANOVA, то есть общая дисперсия между всеми группами.</p>
<p>Для трех групп имеет большую мощность чем Тьюки. Но если групп больше чем 3, то контролирует FWER на уровне больше 0.05 и следовательно к использованию не рекомендуется.</p>
<p>Подробнее, почему это так, можно посмотреть <a href="https://www.youtube.com/watch?v=cAltDstP6ik&amp;list=PLLTSM0eKjC2dvba2A0VCUogEGDch6cXFN&amp;index=5">здесь</a>.</p>
</section>
<section id="поправка-тьюки-tukey-tukeyhsd" class="level2">
<h2 class="anchored" data-anchor-id="поправка-тьюки-tukey-tukeyhsd">Поправка Тьюки (Tukey, TukeyHSD)</h2>
<p>Используется как постхок тест вне зависимости от значимости ANOVA (подробнее ниже) для сравнения средних групп между собой, чтобы узнать <em>какие именно</em> группы различаются. Также нет ограничения на количество групп, участвующих в сравнении.</p>
<p>В этом тесте сравнивается каждая группа с каждой, поэтому у него будет минимальная мощность, так как тестов больше всего. Если нам не нужно сравнивать каждую группу с каждой, то лучше использовать тест Даннета, который сравнивает одну группу с остальными и имеет более высокую мощность.</p>
<p>Формула расчета тестовой статистики:</p>
<p><img src="https://latex.codecogs.com/png.latex?%20q_s%20=%20%5Cfrac%7BM_1%20-%20M_2%7D%7B%5Csqrt%7B%5Cfrac%7BSS_w%7D%7B2%7D(%5Cfrac%7B1%7D%7Bn_A%7D+%5Cfrac%7B1%7D%7Bn_B%7D)%7D%7D,%20%20"></p>
<p>где M<sub>1</sub> &gt; M<sub>2</sub> (средние в группе), <em>nA</em>, <em>nB</em> - размер 1 и 2 выборки, <img src="https://latex.codecogs.com/png.latex?SS_W"> - внутригрупповая сумма квадратов в ANOVA.</p>
<p>Для проверки гипотезы используется studentized range distribution, студентизированное распределение (не путать с t-распределением).</p>
<p>У теста Тьюки есть допущения к использованию:</p>
<ul>
<li><p>Независимость наблюдений</p></li>
<li><p>Примерное равенство дисперсий</p></li>
<li><p>Примерно нормальное распределение данных в группах</p></li>
</ul>
<p>Если допущения про нормальность распределения и равенство дисперсий не выполняются, то можно использовать непараметрические аналоги теста.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Про значимую ANOVA
</div>
</div>
<div class="callout-body-container callout-body">
<p>Тест Тьюки вовсе необязательно использовать <em>только</em> после значимой ановы, как нередко пишут в учебниках, просто в тесте при расчете используется внутригрупповая сумма квадратов и количество степеней свободы из таблицы ANOVA. Поэтому в докомпьютерное время расчет критерия Тьюки был <u>проще</u> после дисперсионного анализа, и при незначимой анове сравнивать группы между собой уже не имело смысла. Сейчас в R в функции <code>TukeyHSD()</code> для расчета критерия Тьюки в качестве инпута используется результат ановы, но никто не запрещает применять тест и если анова оказалась незначимой.</p>
<p>Также может быть и ситуация, когда по результатам ANOVA получилось, что средние групп различаются между собой, но при этом по Тьюки нет, можно почитать <a href="https://stats.stackexchange.com/questions/16665/how-can-i-get-a-significant-overall-anova-but-no-significant-pairwise-difference">здесь</a>, почему так бывает.</p>
</div>
</div>
</section>
<section id="тест-данна-dunn" class="level2">
<h2 class="anchored" data-anchor-id="тест-данна-dunn">Тест Данна (Dunn)</h2>
<p>Является непараметрическим постхок тестом, аналогом теста Тьюки, для ситуаций, когда его допущения не выполняются.</p>
<p>По сути сравнивает средний ранг групп, вычисленных после теста Краскелла-Уоллиса (Kruskal-Wallis), таким образом как бы учитывая общую дисперсию между группами (чего не будет происходить в попарных тестах Манна-Уитни). Далее полученные p-value должны быть поправлены любым методом, например Бонферрони, Холм, FDR.</p>
<p>Лично мне это в свое время сломало мозг, что это поправка в поправке, вроде используем постхок тест, но при этом его результат тоже нужно поправить тестом на выбор (в функции <code>dunn_test()</code> из пакета <code>rstatix</code> поправка Холма происходит автоматически).</p>
<p>Как альтернатива, в качестве непараметрического аналога Тьюки можно использовать попарные тесты Манна-Уитни с поправками, однако ранги будут рассчитаны отдельно для каждого теста.</p>
<p>Оригинальная статья про метод:</p>
<p>Dunn, O. J. (1964) Multiple comparisons using rank sums Technometrics, 6(3):241-252.</p>
</section>
<section id="тест-даннета-dunnet" class="level2">
<h2 class="anchored" data-anchor-id="тест-даннета-dunnet">Тест Даннета (Dunnet)</h2>
<p>С помощью этого теста сравнивают одну группу с остальными группами, например, когда задача сравнить контрольную группу и несколько воздействий, и не нужно сравнение каждой группы с каждой</p>
<p>Например, у нас 4 группы, из которой одна группа контрольная, с которой мы проводим сравнения. У нас будет всего 3 сравнения: control - A, control - B, control - C, что увеличивает мощность теста.</p>
<p>Для теста Даннета должны соблюдаться такие же допущения, как и для теста Тьюки: независимость наблюдений, примерно равная дисперсия в группах и нормальное распределение.</p>
<p>Посмотреть детально можно <a href="https://www.youtube.com/watch?v=5pPd2rLS1GU&amp;list=PLLTSM0eKjC2dvba2A0VCUogEGDch6cXFN&amp;index=8">здесь</a>.</p>
<p>Теперь перейдем к принципиально другому подходу поправок – контроле доли ложных открытий (FDR).</p>
</section>
</section>
<section id="fdr---false-discovery-rate" class="level1">
<h1>FDR - false discovery rate</h1>
<section id="определение-fdr" class="level2">
<h2 class="anchored" data-anchor-id="определение-fdr">Определение FDR</h2>
<p>FDR, false discovery rate – доля ложнопозитивных результатов.</p>
<p>В скрининговых экспериментах, таких как анализ RNA-seq данных важнее контролировать долю ложнопозитивных результатов (FDR), чем вероятность совершить хоть одно ложное открытие.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 36%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>H<sub>0</sub> верна (различий нет)</th>
<th>H<sub>0</sub> неверна (различие есть)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Не отклонить H<sub>0</sub></td>
<td>True Negative (TN)</td>
<td>False Negative (FN)</td>
</tr>
<tr class="even">
<td>Отклонить H<sub>0</sub></td>
<td>False Positive (FP)</td>
<td>True Positive (TP)</td>
</tr>
</tbody>
</table>
<p><img src="https://latex.codecogs.com/png.latex?%20FDR%20=%20%5Cfrac%7BFP%7D%7BFP%20+%20TP%7D%20"></p>
<p>Подробнее в этом <a href="https://www.youtube.com/watch?v=-oIkIdhSNeU">видео</a>.</p>
</section>
<section id="расчет-fdr" class="level2">
<h2 class="anchored" data-anchor-id="расчет-fdr">Расчет FDR</h2>
<p>Расмотрим контроль FDR по методу Бенджамини-Хохберга (Benjamini-Hochberg), так как он используется чаще всего. Также FDR можно посчитать с помощью метода Benjamini-Yekutieli, но он имеет меньшую мощность и используется реже.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">p_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.361</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.387</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.005</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.009</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.022</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.051</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.101</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.019</span>)</span></code></pre></div>
</div>
<ul>
<li>Сортируем и ранжируем p-value по возрастанию;</li>
<li>Каждое p-value умножаем на <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bm%7D%7Brank%7D">, где <img src="https://latex.codecogs.com/png.latex?m"> – количество тестов, <img src="https://latex.codecogs.com/png.latex?rank"> – ранг p-value.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">pvalue</th>
<th style="text-align: right;">rank_pvalue</th>
<th style="text-align: left;">formula</th>
<th style="text-align: right;">result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">0.005*(8/1)</td>
<td style="text-align: right;">0.0400000</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.009</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">0.009*(8/2)</td>
<td style="text-align: right;">0.0360000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.019</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">0.019*(8/3)</td>
<td style="text-align: right;">0.0506667</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.022</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">0.022*(8/4)</td>
<td style="text-align: right;">0.0440000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.051</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">0.051*(8/5)</td>
<td style="text-align: right;">0.0816000</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.101</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">0.101*(8/6)</td>
<td style="text-align: right;">0.1346667</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.361</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">0.361*(8/7)</td>
<td style="text-align: right;">0.4125714</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.387</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">0.387*(8/8)</td>
<td style="text-align: right;">0.3870000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Итоговое FDR вычисляется так, чтобы p-value не убывали, но при этом приводится в меньшую сторону (в отличие от поправки Холма), поэтому процедура называется пошаговой восходящей – step-up.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">pvalue</th>
<th style="text-align: right;">rank_pvalue</th>
<th style="text-align: left;">formula</th>
<th style="text-align: right;">result</th>
<th style="text-align: right;">p_adjusted</th>
<th style="text-align: left;">reject_H0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">0.005*(8/1)</td>
<td style="text-align: right;">0.0400000</td>
<td style="text-align: right;">0.0360000</td>
<td style="text-align: left;">yes</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.009</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">0.009*(8/2)</td>
<td style="text-align: right;">0.0360000</td>
<td style="text-align: right;">0.0360000</td>
<td style="text-align: left;">yes</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.019</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">0.019*(8/3)</td>
<td style="text-align: right;">0.0506667</td>
<td style="text-align: right;">0.0440000</td>
<td style="text-align: left;">yes</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.022</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">0.022*(8/4)</td>
<td style="text-align: right;">0.0440000</td>
<td style="text-align: right;">0.0440000</td>
<td style="text-align: left;">yes</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.051</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">0.051*(8/5)</td>
<td style="text-align: right;">0.0816000</td>
<td style="text-align: right;">0.0816000</td>
<td style="text-align: left;">no</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.101</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">0.101*(8/6)</td>
<td style="text-align: right;">0.1346667</td>
<td style="text-align: right;">0.1346667</td>
<td style="text-align: left;">no</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.361</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">0.361*(8/7)</td>
<td style="text-align: right;">0.4125714</td>
<td style="text-align: right;">0.3870000</td>
<td style="text-align: left;">no</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.387</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">0.387*(8/8)</td>
<td style="text-align: right;">0.3870000</td>
<td style="text-align: right;">0.3870000</td>
<td style="text-align: left;">no</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>FDR в основном используется в скрининговых экспериментах, где ключевые результаты могут быть проверены уже более прицельным экспериментом (например некоторые дифференциально экспрессирующиеся гены по результатам RNA-seq проверяют количественной ПЦР).</p>
</section>
</section>
<section id="как-выбрать-поправку" class="level1">
<h1>Как выбрать поправку?</h1>
<p>Все зависит от задачи. Лично я стараюсь ответить на вопрос, что в конкретном случае важнее контролировать - FWER или FDR. Разумно использовать FDR в массовых экспериментах, где количество тестов исчисляется десятками тысяч, при этом найти ложнопозитивный результат не так страшно. FWER же контролируют в более fine-scale экспериментах, где нам не хотелось бы совершить ошибку первого рода или где ее цена очень высока (исследования на человеке).</p>
<p>Если у нас есть конкретный тест, например Тьюки для сравнения групп между собой, то обычно его и используют, если же ситуация более нестандартная, допустим после бутстреп теста нужно сделать поправку на множественное тестирование, то здесь я бы использовала поправку Холма.</p>
<p>В любом случае нужно опираться на особенности и ограничения тестов, которые я постаралась расписать, надеюсь это поможет выбрать тест <del>мудро</del> правильно.</p>
<p>Посмотреть подробнее про все поправки на множественное тестирование можно в <a href="https://www.youtube.com/playlist?list=PLLTSM0eKjC2dvba2A0VCUogEGDch6cXFN">этой серии</a> видео от замечательного канала по статистике @<a href="https://www.youtube.com/@tilestats">TileStats</a></p>
<p>А также подписывайтесь на <a href="https://t.me/stats_for_science">телеграм-канал</a>, делитесь постом, пишите комментарии!</p>
<p><img src="https://ubogoeva.github.io/R4Analytics/images/logo_final_tlg.png" class="img-fluid"></p>


</section>

 ]]></description>
  <category>statistics</category>
  <guid>https://ubogoeva.github.io/R4Analytics/posts/multiple_testing.html</guid>
  <pubDate>Tue, 28 Nov 2023 18:00:00 GMT</pubDate>
</item>
<item>
  <title>Как задать хороший вопрос в R чате?</title>
  <dc:creator>Elena U</dc:creator>
  <link>https://ubogoeva.github.io/R4Analytics/posts/R_question_how_to_ask.html</link>
  <description><![CDATA[ 
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(97025960, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/97025960" style="position:absolute; left:-9999px;" alt=""></div></noscript>
<!-- /Yandex.Metrika counter -->





<p>Для русскоязычного R-комьюнити есть два больших чата: <a href="https://t.me/rlang_ru">R (язык программирования)</a> и <a href="https://t.me/hotlineR_EU">Горячая линия R</a>. Здесь я бы хотела поделиться своим опытом задавания вопросов и создания воспроизводимых примеров (reprex, репрекс).</p>
<p>Reprex (<u>repr</u>oducible <u>ex</u>ample) – это минимальный пример кода, воспроизводящий ошибку или описывающий, что требуется сделать.</p>
<p>Такой пример кода удобно копируется в чат с соответствующим форматированием, его легко читать и можно сразу же скопировать себе, чтобы попробовать помочь.</p>
<p>Для создания репрексов рекомендуется использовать одноименный пакет <a href="https://reprex.tidyverse.org/"><code>reprex</code></a>.</p>
<p>Установка: <code>install.packages('reprex')</code></p>
<p>Далее я обычно даже не загружаю пакет, а сразу пишу <code>reprex::reprex()</code>. Вариантов использования функции несколько, лично мне удобнее всего оказалось писать нужные строчки кода внутри фигурных скобок функции <code>reprex::reprex({})</code>.</p>
<p>У репрекса есть три важных свойства:</p>
<ul>
<li>код должен работать (то есть все пакеты загружены и все переменные объявлены)</li>
<li>код легко запустить (никаких скриншотов и копирования из консоли со знаком <code>&gt;</code>)</li>
<li>код можно не запускать (в репрексе есть аутпут, и можно понять в чем ошибка, даже без запуска кода)</li>
</ul>
<p>Например:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">reprex<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reprex</span>({</span>
<span id="cb1-2">    mtcars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-3">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-4">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cyl) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-5">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(mpg)</span>
<span id="cb1-6">})</span></code></pre></div>
</div>
<p>При попытке запустить такой код у меня сразу появилось, что нет функции <code>%&gt;%</code>, даже если пайп работал до этого. Репрекс создает совершенно новую сессию и поэтому необходимо загрузить все пакеты и объявить все переменные, даже если они уже были загружены и объявлены в скрипте. Соответственно, от своих реальных данных, на которых произошла ошибка, нужно взять минимальный воспроизводимый пример. Обычно я создаю игрушечные датасеты <code>df &lt;- data.frame(a  = 1:10, b = letters[1:10])</code>, на которых воссоздаю ошибку. Также можно использовать встроенные датасеты, например <code>mtcars</code>, <code>iris</code>.</p>
<p>Созданный с помощью функции <code>reprex::reprex()</code> код можно сразу же копировать в телеграм-чат, оформление как код будет сразу же задано с помощью трех бэктиков ```. Однако в новых версиях телеграма появилась подсветка синтаксиса, если вставить код с указанием языка после трех бэктиков ```r, что максимально облегчает работу с кодом и повышает вероятность, что вам смогут помочь с запросом.</p>
<p>В случае если данные все же очень сложные, то можно воспользоваться функцией <code>dput</code>. Например, взять первые несколько строк <code>head</code>-ом и поместить в <code>dput</code>: <code>dput(head(mtcars))</code>, где вместо mtcars ваши данные. В результате будет сложная выдача <code>structure(list...)</code>, которую можно скопировать и в репрексе создать такую переменную.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">reprex<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reprex</span>({</span>
<span id="cb2-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb2-3">    df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">structure</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mpg =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">22.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">21.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18.7</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18.1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cyl =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), </span>
<span id="cb2-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">disp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">160</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">160</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">108</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">258</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">360</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">225</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">93</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">175</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">105</span>), </span>
<span id="cb2-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">drat =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.85</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.08</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.15</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.76</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">wt =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.62</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.875</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.32</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.215</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.44</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.46</span>),</span>
<span id="cb2-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">qsec =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">16.46</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">17.02</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18.61</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">19.44</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">17.02</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20.22</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb2-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">am =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gear =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), </span>
<span id="cb2-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">carb =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)), </span>
<span id="cb2-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mazda RX4"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mazda RX4 Wag"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Datsun 710"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hornet 4 Drive"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hornet Sportabout"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Valiant"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.frame"</span>)</span>
<span id="cb2-10">    df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb2-11">}) </span></code></pre></div>
</div>
<p>При таком подходе рекомендуется постараться минимизировать пример, максимально изолировать ошибку, чтобы было удобнее читать и помогать.</p>
<p>Если вопрос не об ошибке, а о том, что нужно сделать, то желательно показать ход мысли, как пытались решить самостоятельно, и можно создать образец данных, которые нужно получить. Вот пара примеров (<a href="https://t.me/rlang_ru/102330">здесь</a> и <a href="https://t.me/rlang_ru/151373">здесь</a>) моих вопросов в чате R.</p>
<p>Вообще создание репрекса может занять много времени, но это является крайне полезным. Несколько раз я начинала писать вопрос, создавала репрекс и на этапе создания понимала, в чем ошибка, в итоге репрекс помог сам по себе, даже без обращения к участникам чатов. Один раз успела отправить сообщение и при перечитывании поняла, что было не так, но мне уже успели ответить, не стала удалять.</p>
<p>Ответы на часто (один раз) задаваемые вопросы:</p>
<p><em>Вопрос 1</em>: почему бы просто не скинуть таблицу и образец своего скрипта, тогда можно будет сразу на реальных данных показать все?</p>
<p><em>Ответ</em>: мне кажется неудобным сохранять данные, сохранять скрипт себе, загружать таблицу заново, когда можно было бы просто скопировать из чата, не забивая себе файловую систему.</p>
<p><em>Вопрос 2</em>: почему бы не использовать <code>.RData</code>?</p>
<p><em>Ответ</em>: в целом, рдату использовать чуть лучше, но все же минусы про файловую систему остаются актуальными. Плюс идея репрекса в минимизации и изолировании примера, чтобы оставались только проблемные строки и столбцы, для фокусировки внимания.</p>
<p>Еще парочка ссылок: <a href="https://www.tidyverse.org/help/">инструкция</a> от Хэдли, <a href="https://mastering-shiny.org/action-workflow.html?q=help#reprex-basics">пример</a> создания репрекса на shiny, <a href="https://reprex.tidyverse.org/articles/learn-reprex.html">слайды</a> и 50-минутное видео о репрексах от Дженни Брайан (презентация очень крутая, наиболее информативная, советую посмотреть).</p>
<p>В общем, рекомендую использовать этот подход, тогда освоение R будет более приятным и успешным. На стаковерфлоу результат репрекса тоже можно забрасывать, я думаю, но возможно туда еще нужно указать результаты <code>sessionInfo()</code> (поправьте в комментариях, если не так). Сама новые вопросы на стаковерфлоу не писала, хватает обычно уже существующих для моих задач.</p>
<p>Подписывайтесь на телеграм-канал: <a href="https://t.me/stats_for_science" class="uri">https://t.me/stats_for_science</a>, будет много интересного.</p>
<p><img src="https://ubogoeva.github.io/R4Analytics/images/logo_final_tlg.png" class="img-fluid"></p>



 ]]></description>
  <category>R</category>
  <guid>https://ubogoeva.github.io/R4Analytics/posts/R_question_how_to_ask.html</guid>
  <pubDate>Thu, 01 Dec 2022 18:00:00 GMT</pubDate>
</item>
<item>
  <title>Виды пределов погрешностей</title>
  <dc:creator>Elena U</dc:creator>
  <link>https://ubogoeva.github.io/R4Analytics/posts/types_of_error_bars.html</link>
  <description><![CDATA[ 
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(97025960, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/97025960" style="position:absolute; left:-9999px;" alt=""></div></noscript>
<!-- /Yandex.Metrika counter -->





<div class="cell">
<style type="text/css">
.spoiler {
  visibility: hidden;
}

.spoiler::before {
  background-color: #d6d6d6;
  visibility: visible;
  content: "Spoiler alert!"
}

.spoiler:hover {
  visibility: visible;
}

.spoiler:hover::before {
  display: none;
}
</style>
</div>
<p>Сегодня поговорим о различных видах пределов погрешностей или усов, как пишут в русскоязычной литературе (error bars).</p>
<p><em>Предупреждаю сразу: по ходу повествования я буду использовать все варианты написания этого термина, даже слово эррор бар.</em></p>
<p>Важно отметить, что существует два принципиально разных вида отображения пределов погрешностей на графике:</p>
<ul>
<li>отражение описательных статистик (descriptive statistics);</li>
<li>отражение статистик вывода (inferential statistics).</li>
</ul>
<p>Они выглядят на графике одинаково, но по факту фундаментально различны. Давайте разбираться, в чем разница.</p>
<section id="descriptive-error-bars-описательные-пределы-погрешностей" class="level2">
<h2 class="anchored" data-anchor-id="descriptive-error-bars-описательные-пределы-погрешностей">Descriptive error bars (Описательные пределы погрешностей)</h2>
<p>К описательным эррор барам относятся:</p>
<ul>
<li>Размах (range): разница между максимальным и минимальным значением в выборке (X<sub>max</sub> - X<sub>min</sub>).</li>
<li>Межквартильный размах (interquartile range, IQR): разница между третьм квартилем (Q<sub>3</sub>) и первым квартилем (Q<sub>1</sub>.).</li>
<li>Стандартное отклонение (standard deviation, sd): квадратный корень из дисперсии.</li>
</ul>
<p><strong>Размах</strong> самая простая для понимания метрика, при этом редко использующаяся, поскольку сама по себе разница между максимальным и минимальным значением довольно-таки малоинформативна.</p>
<p><strong>Межквартильный размах (IQR)</strong>, точнее 1.5*IQR чаще всего используется на боксплотах (boxplot), я редко встречала 1*IQR или 1.5*IQR как усы к обычным барплотам.</p>
<p><em>Барплот (barplot) - столбчатая диаграмма для категориальных данных, их будет много чуть дальше.</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/images/boxplot.png" class="img-fluid figure-img"></p>
<figcaption><em>Самое простое описание составляющих боксплота</em></figcaption>
</figure>
</div>
<p>Если расставить числа в ряд по возрастанию, то середина этого ряда - медиана (median) или второй квартиль (Q<sub>2</sub>). Первый квартиль (Q<sub>1</sub>) - значение, меньше которого 25% процентов данных, третий квартиль (Q<sub>3</sub>) - значение, меньше которого 75% данных.</p>
<p>Думаю, что на рисунке понять проще:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/images/IQR.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption><em>про межквартильный размах (IQR)</em></figcaption>
</figure>
</div>
<p>Межквартильный размах намного чаще используется для визуализации, так как предоставляет больше информации о данных.</p>
<p><strong>Стандартное отклонение (standard deviation)</strong> по-моему наиболее часто встречается в публикациях и на конференциях (по крайней мере в биологии), да и я обычно использую именно sd в качестве предела погрешностей.</p>
<p>Формула стандартного отклонения (для генеральной совокупности): <img src="https://latex.codecogs.com/png.latex?%5CLarge%20sd%20=%20%5Csqrt%7Bvar%7D%20=%20%5Csqrt%7B%5Cfrac%7B%5Csum_%7Bi=1%7D%5E%7BN%7D(x_%7Bi%7D%20-%20%5Cmu)%5E2%7D%7BN%7D%7D">Где <img src="https://latex.codecogs.com/png.latex?%5Cmu"> - среднее значение в генеральной совокупности, <img src="https://latex.codecogs.com/png.latex?N"> - размер генеральной совокупности, var (variance) - дисперсия. Но мы обычно работаем с выборками, а не генеральной совокупностью, и в формуле вычисления sd в Excel и R используют <em>несмещенную (unbiased)</em> оценку дисперсии и стандартного отклонения (потому что для выборки): <img src="https://latex.codecogs.com/png.latex?%5CLarge%20sd%20=%20%5Csqrt%7Bvar%7D%20=%20%5Csqrt%7B%5Cfrac%7B%5Csum_%7Bi=1%7D%5E%7BN%7D(x_%7Bi%7D%20-%20%5Coverline%7Bx%7D)%5E2%7D%7BN-1%7D%7D"></p>
<p>Почему именно <img src="https://latex.codecogs.com/png.latex?N-1"> в знаменателе выходит за рамки нашего обсуждения, поэтому ограничусь ссылками: <a href="https://www.quora.com/Why-do-we-use-n-1-instead-of-n-for-a-samples-variance">1</a>, <a href="https://stats.stackexchange.com/questions/198452/why-sample-variance-has-has-n-1-in-the-denominator">2</a>, <a href="https://youtu.be/SzZ6GpcfoQY?t=435">видео с таймкодом</a>.</p>
<p>Еще не сделала схему с детальным вычислением стандартного отклонения на реальных данных, поэтому пока можно посмотреть на <a href="https://www.youtube.com/watch?v=SzZ6GpcfoQY">статквесте</a>.</p>
<p>Важный момент! Все вышеописанные метрики отражают разброс значений в нашей <strong>выборке</strong>, без каких-либо предположений о происходящем в генеральной совокупности. В этом отличие от второго типа error bar.</p>
</section>
<section id="inferential-error-bars" class="level2">
<h2 class="anchored" data-anchor-id="inferential-error-bars">Inferential error bars</h2>
<p>К эррор барам, отражающим статистики вывода относятся:</p>
<ul>
<li>Стандартная ошибка среднего (standard error of mean, SEM или просто SE);</li>
<li>Доверительный интервал (confidence interval, CI).</li>
</ul>
<p>Принципиальное отличие от описательных пределов погрешности в том, что грубо говоря, стандартная ошибка среднего/доверительный интервал пытаются отразить степень уверенности в поиске к примеру <em>истинного среднего</em> генеральной совокупности. В то время как описательные отражают, что происходит конкретно в <em>нашей выборке</em>.</p>
<p>Тут немного инфы для продвинутых (не открывайте, если не уверены, что хотите это знать!):</p>
<p><span class="spoiler">Небольшое уточнение: с помощью бутстрепов можно оценивать не только доверительный интервал и стандартную ошибку для среднего, но и для медианы и даже для стандартного отклонения, но про это сейчас не будем</span></p>
<section id="стандартная-ошибка-среднего" class="level3">
<h3 class="anchored" data-anchor-id="стандартная-ошибка-среднего">Стандартная ошибка среднего</h3>
<p>Теперь еще немного вымученных формулировок, которые попробую сформулировать понятнее.</p>
<p>Вымученная формулировка: <em>The standard error (SE) of a statistic is the standard deviation of its sampling distribution or an estimate of that standard deviation.</em> (цитата прямо из <a href="https://en.wikipedia.org/wiki/Standard_error">википедии</a>)</p>
<p>Формула вычисления стандартной ошибки среднего очень простая - стандартное отклонение, деленное на квадратный корень из размера выборки. Но что на самом деле это значит, какой физический смысл стоит за результатом этого вычисления? Попробуйте сами ответить на этот вопрос, опираясь только на определение из википедии и формулу)</p>
<p>Теперь попробуем представить, что мы провели некий эксперимент, например измеряли вес 20 мышей после какого-либо воздействия и усредняли полученные значения. При этом мы решили 10 раз повторить свой эксперимент, в результате чего получили 10 средних значений. После этого мы можем посчитать среднее средних (!) и <strong>стандартное отклонение средних</strong>. Вот это стандартное отклонение выборочных средних и есть стандартная ошибка среднего. Ура? Пойду воспроизводить эксперимент по 10 раз?</p>
<p>Но мы не всегда (обычно никогда) можем себе позволить повторять эксперимент по 10 раз, и хитрость в том, что мы можем вычислить стандартную ошибку среднего без многократного повторения эксперимента, просто поделив стандартное отклонение на квадратный корень из размера выборки.</p>
<p>Вот <a href="https://pozdniakov.github.io/tidy_stats/310-infer_stats.html#sec-sample_dist">тут</a> хорошо расписано, как моделировать стандартную ошибку средних и что она действительно соответствует стандартному отклонению, деленному на квадратный корень из числа наблюдений.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Chuge%20SE%20=%20%5Cfrac%7Bsd%7D%7B%5Csqrt%7BN%7D%7D"> <em>Формула SE (стандартной ошибки), где sd - это стандартное отклонение, N - количество наблюдений</em></p>
<p>Вот еще можно посмотреть про:</p>
<ul>
<li>отличия стандартного отклонения от стандартной ошибки <a href="https://www.youtube.com/watch?v=SzZ6GpcfoQY" class="uri">https://www.youtube.com/watch?v=SzZ6GpcfoQY</a></li>
<li>объяснение стандартной ошибки с бутстреп-примером <a href="https://www.youtube.com/watch?v=XNgt7F6FqDU&amp;t=341s" class="uri">https://www.youtube.com/watch?v=XNgt7F6FqDU&amp;t=341s</a></li>
</ul>
<p>В <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2064100/">статье</a>, на которую я опиралась при написании этого материала, было указано, что для представления сравнения групп лучше использовать стандартную ошибку/доверительный интервал как error bar, а не стандартное отклонение и другие описательные статистики.</p>
<p>Но у меня есть неприятное подозрение, что для публикаций и представлений своей работы на конференциях некоторые недобросовестные ученые используют se, чтобы на графиках были усы поменьше. Однако, я не хочу обидеть тех, кто использует стандартную ошибку и понимает физический смысл. Интересно будет собрать примеры работ, где использование se оправданно и разумно, и где это не так, поэтому если есть примеры, то пишите в комментарии.</p>
<p>В целом, плюс именно se в том, что при отрисовке сравнений двух или нескольких групп, перекрываемость усов позволяет судить об отсутствии статистической значимости различий (при этом наоборот не работает, про это будет еще чуть дальше), в то время как sd и остальные описательные пределы погрешностей - нет. Однако sd показывает данные почти как они есть, то есть реальный разброс в наших данных, без предположений о генеральной совокупности, поэтому лично я предпочитаю sd для отрисовки. Это тоже интересная тема для дискуссии, буду рада обсудить в комментариях.</p>
<p>И наконец…</p>
</section>
<section id="доверительный-интервал" class="level3">
<h3 class="anchored" data-anchor-id="доверительный-интервал">Доверительный интервал</h3>
<p>Если простыми словами, то доверительный интервал оценивает диапазон, в котором с заданной уверенностью (например 95%), можно ожидать истинное значение параметра, например среднего генеральной совокупности.</p>
<p>Прикрепляю формулу (кстати все формулы записаны прямо силами Rmarkdown):</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Chuge%20CI%20=%20%5Coverline%7Bx%7D%20%C2%B1%20z%5Cfrac%7Bs%7D%7B%5Csqrt%7Bn%7D%7D"></p>
<p>Формула доверительного интервала (CI), <img src="https://latex.codecogs.com/png.latex?%5Coverline%7Bx%7D"> - среднее значение выборки, z - значение уровня достоверности, например для 95% уровня достоверности, <img src="https://latex.codecogs.com/png.latex?z%20=%201.96">, <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bs%7D%7B%5Csqrt%7Bn%7D%7D"> - формула уже знакомой стандартной ошибки.</p>
<p>Вообще я не люблю эту тему, но к счастью уже существует немало источников, которые объяснили доверительный интервал разными способами:</p>
<ul>
<li><p>В <a href="https://pozdniakov.github.io/tidy_stats/310-infer_stats.html#sec-ci_build">книге</a> у Ивана объяснение доверительных интервалов классическим образом через формулу стандартной ошибки;</p></li>
<li><p>Классное объяснение доверительных интервалов с помощью бутстрепа на <a href="https://www.youtube.com/watch?v=TqOeMYtOc1w&amp;t=325s">статквесте</a> (канал супер, всем рекомендую);</p></li>
<li><p>Бонусом для тех, кому это все слишком просто: я нашла совершенно дикую статью про доверительные интервалы, доверительные полосы и доверительные эллипсы (sic!), поэтому кто желает преисполниться - велком (вот <a href="https://r-analytics.blogspot.com/2018/04/blog-post_28.html?m=1">ссылка</a>). Краткого пересказа не будет, это надо прочитать самостоятельно.</p></li>
</ul>
<p>Небольшой вывод. Отрисовка доверительных интервалов сейчас считается модной, якобы их проще интерпретировать. Но на самом деле доверительный интервал как и p-value - это один из тех концептов, которые провоцируют просто огромное количество мисинтерпретаций, это кстати одна из причин, по которой я это не люблю рассказывать. Важно сейчас отметить вот что:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/images/se_overlap.png" class="img-fluid figure-img"></p>
<figcaption><em>Интерпретация перекрывания inferential error bars. Ссылка на <a href="https://www.graphpad.com/support/faq/spanwhat-you-can-conclude-when-two-error-bars-overlap-or-dontspan/">статью</a>, откуда картинка</em></figcaption>
</figure>
</div>
<p>Таким образом, <strong>перекрывание</strong> стандартных ошибок говорит об <strong>отсутствии</strong> значимости в различии, при этом обратное не верно, а с доверительными интервалами наоборот - <strong>отсутствие перекрывания</strong> доверительных интервалов говорит о <strong>значимости</strong> различий, в то время обратное не верно.</p>
<p>В этом смысле мне нравится концепция стандартного отклонения, потому что их перекрывание или не перекрывание не говорит нам вообще ничего, а значит - нельзя запутаться!). Чуть дальше разберем, как выглядят разные пределы погрешностей!</p>
<p><strong>В любом случае, вне зависимости какой тип пределов погрешностей вы выбрали для отображения на графике, всегда нужно подписывать какой, потому что интерпретации совершенно разные.</strong></p>
</section>
</section>
<section id="а-что-если-вообще-не-рисовать-пределы-погрешностей" class="level2">
<h2 class="anchored" data-anchor-id="а-что-если-вообще-не-рисовать-пределы-погрешностей">А что если вообще не рисовать пределы погрешностей?</h2>
<p>Если число значений в выборке невелико (например меньше 10), то лучше нарисовать все числа как они есть, например с помощью диаграммы рассеяния (scatter plot) без редуцирования информации в боксплоты или барплоты с пределами погрешностей. Если значений больше, то возможно множество вариантов отрисовывания, часто исследователи используют просто барплоты с пределами погрешностей или боксплоты, однако здесь я предлагаю два возможных варианта более репрезентативного отображения данных.</p>
<p>Первый - это отрисовать violin plot (скрипичная диаграмма), но не просто, а с небольшим боксплотом внутри. Я эту идею подчерпнула на курсе бластима по R, мне показалось очень забавно, прикрепляю небольшой пример как это выглядит на примере данных <code>iris</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2">violin_box <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> iris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Species, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Sepal.Width))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_violin</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Species))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span>
<span id="cb1-7">violin_box</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/types_of_error_bars_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Второй вариант больше подойдет для относительно небольшого количества наблюдений, когда счет идет на десятки, но не тысячи точек. Это комбинация боксплота и отображения точек как они есть с помощью <code>geom_jitter()</code> в пакете <code>ggplot2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">box_point <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> iris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(Species, Sepal.Width))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_jitter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> Species), </span>
<span id="cb2-5">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_jitter</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb2-6">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span>
<span id="cb2-8">box_point</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/types_of_error_bars_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>По моему прикольно получилось! Эти варианты визуализации содержат гораздо больше информации, сравните например с обычными боксплотами и барплотами (здесь как предел погрешности использовала стандартное отклонение).</p>
<hr>
<p>📝 UPD: в комментариях посоветовали напомнить, что перекрывание или не-перекрывание усов в боксплотах и вайлин плотах не имеет отношения к статистике вывода, то есть не позволяет делать выводы о значимости различий</p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">box <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> iris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(Species, Sepal.Width, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Species))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span>
<span id="cb3-5">bar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> iris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean_PW =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Sepal.Width), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd_PW =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(Sepal.Width)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(Species, mean_PW, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Species))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'identity'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> mean_PW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> sd_PW, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> mean_PW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sd_PW), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Sepal Width'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Error bars are standard deviation'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span>
<span id="cb3-14">box</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/types_of_error_bars_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">bar</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/types_of_error_bars_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>А теперь все вместе на одном графике (обратите внимание на пакет <code>patchwork</code> для красивого объединения плотов на одном рисунке):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(patchwork)</span>
<span id="cb5-2">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (violin_box <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> box_point) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (box <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bar)</span>
<span id="cb5-3">p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_annotation</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tag_levels =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'A'</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/types_of_error_bars_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Голосуйте, какой плот больше нравится и является более информативным. Мне лично здесь нравится вариант B - box+точки, кажется наиболее информативным и красивым. Возможно, если наблюдений будет больше, то лучше окажется первый вариант с вайлином плотом и боксом.</p>
<hr>
<p>📝 В violin plot-е (скрипичная диаграмма) форма отражает плотность распределения значений. Грубо говоря, чем больше значений в диапазоне, тем толще соответствующий диапазон на графике. В случае <code>geom_jitter</code> по оси X важна только принадлежность точек к группе, внутри одной группы точки по оси X распределяются так, чтобы не перекрывать друг друга.</p>
<hr>
<p>А теперь визуализация трех основных пределов погрешностей: стандартного отклонения, стандартной ошибки и доверительных интервалов на данных <code>iris</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(data.table)</span>
<span id="cb6-2">bar_se <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> iris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean_PW =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Sepal.Width), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se_PW =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(Sepal.Width)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(Sepal.Width))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(Species, mean_PW, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Species))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'identity'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> mean_PW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> se_PW, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> mean_PW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> se_PW), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Sepal Width'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Error bars are standard error'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bar_se</span></span>
<span id="cb6-12"></span>
<span id="cb6-13">bar_CI <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> iris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Sepal.Length), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(Sepal.Length)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> sd<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(n))  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ic =</span> se <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qt</span>((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">-0.05</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, n<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(Species, mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Species))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'identity'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> mean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ic, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> mean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> ic), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Sepal Width'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Error bars are confidence intervals'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span>
<span id="cb6-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bar_CI</span></span>
<span id="cb6-25">bar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bar_se <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bar_CI<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_layout</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/types_of_error_bars_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Теперь я сделаю одну плохую вещь, а именно <strong>просто</strong> сравню тестом Стьюдента Sepal.Width для разных видов ириса. Как думаете, почему это плохо?</p>
<p><span class="spoiler">Я в этом примере не делаю поправку на множественное тестирование</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">iris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setDT</span>() </span>
<span id="cb7-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'versicolor vs setosa: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">p-value of the test'</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(iris[Species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'setosa'</span>, Sepal.Width], iris[Species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'versicolor'</span>, Sepal.Width])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>versicolor vs setosa: 
p-value of the test 2.484228e-15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'setosa vs virginica: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">p-value of the test'</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(iris[Species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'setosa'</span>, Sepal.Width], iris[Species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'virginica'</span>, Sepal.Width])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>setosa vs virginica: 
p-value of the test 4.570771e-09</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'virginica vs versicolor: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">p-value of the test'</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t.test</span>(iris[Species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'virginica'</span>, Sepal.Width], iris[Species <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'versicolor'</span>, Sepal.Width])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>virginica vs versicolor: 
p-value of the test 0.001819483</code></pre>
</div>
</div>
<p>Но один раз в жизни можно, только для демонстрации того, что все выборки значимо отличаются друг от друга (без поправки), и на графиках можно увидеть что доверительные интервалы не перекрываются.</p>
<p>Ура! Я дописала, а вы дочитали, с чем я всех и поздравляю) Теперь перейдем к выводам.</p>
</section>
<section id="выводы" class="level2">
<h2 class="anchored" data-anchor-id="выводы">Выводы</h2>
<ol type="1">
<li>Существует два типа отображения пределов погрешностей на графике: описательные, которые <em>описывают</em> значения в конкретно нашей выборке и inferential (так и не придумала как переводить), которые пытаются отразить что-то о генеральной совокупности с заданной долей уверенности.</li>
<li>Для отображения сравнений между группами рекомендуют использовать вторые, поскольку они позволяют делать выводы из перекрывания или не-перекрывания усов.</li>
<li>Однако, есть способы рисовать распределение наших значений без использования мисинтерпретируемых пределов погрешностей, например violin+boxplot и boxplot+точки</li>
</ol>
<p>Подписывайтесь на телеграм канал: <a href="https://t.me/stats_for_science" class="uri">https://t.me/stats_for_science</a>, будет много интересного. Обсудить пост можно <a href="https://t.me/stats_for_science/47">здесь</a> в комментариях.</p>
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/images/logo.jpg" class="img-fluid"></p>


</section>

 ]]></description>
  <category>statistics</category>
  <guid>https://ubogoeva.github.io/R4Analytics/posts/types_of_error_bars.html</guid>
  <pubDate>Mon, 14 Nov 2022 18:00:00 GMT</pubDate>
</item>
<item>
  <title>Инструкция по установке R и RStudio</title>
  <dc:creator>Elena U</dc:creator>
  <link>https://ubogoeva.github.io/R4Analytics/posts/how_to_install_R.html</link>
  <description><![CDATA[ 
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(97025960, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/97025960" style="position:absolute; left:-9999px;" alt=""></div></noscript>
<!-- /Yandex.Metrika counter -->





<section id="на-ubuntu-20.04-22.04" class="level2">
<h2 class="anchored" data-anchor-id="на-ubuntu-20.04-22.04">На Ubuntu 20.04, 22.04</h2>
<p><strong>Шаг 1:</strong> Установить r-base:</p>
<p>Для Ubuntu 22.04: <a href="https://www.how2shout.com/linux/how-to-install-r-base-ubuntu-22-04-lts-jammy/" class="uri">https://www.how2shout.com/linux/how-to-install-r-base-ubuntu-22-04-lts-jammy/</a></p>
<p>Для Ubuntu 20.04: <a href="https://linuxize.com/post/how-to-install-r-on-ubuntu-20-04/" class="uri">https://linuxize.com/post/how-to-install-r-on-ubuntu-20-04/</a></p>
<p><strong>Шаг 2:</strong> Установить зависимости RStudio</p>
<p>В терминале (вызвать можно с помощью сочетания клавиш Ctrl+Alt+T)</p>
<pre><code>sudo apt update
sudo apt install libssl-dev libclang-dev libpq5</code></pre>
<p><strong>Шаг 3:</strong> Установить RStudio</p>
<p>Скачать отсюда <a href="https://www.rstudio.com/products/rstudio/download/#download." class="uri">https://www.rstudio.com/products/rstudio/download/#download.</a> Выбрать бесплатную версию, соответствующую вашей операционной системе. Запустить терминал, перейти в папку загрузок и запустить: <code>sudo dpkg -i &lt;DEB_FILE_NAME&gt;</code>, где ‘DEB_FILE_NAME’ название скачанного .deb файла</p>
<p><strong>Шаг 4:</strong> Установить необходимые для многих R пакетов зависимости</p>
<pre><code>sudo apt update
sudo apt -y install libpng-dev libxml2-dev libxml2 libxrender1 libxtst6 libxi6 libfontconfig1-dev libmagickwand-dev libmagick++-dev
sudo apt -y install libudunits2-dev libgeos-dev libfontconfig1-dev libharfbuzz-dev libfribidi-dev libfreetype6-dev libtiff5-dev libjpeg-dev libpq-dev cargo libcurl4-openssl-dev</code></pre>
<p>Благодаря этой инструкции мне удалось успешно установить tidyverse со всеми его зависимостями на свежую Ubuntu 22.04, так что надеюсь, что у вас тоже все получится!</p>
</section>
<section id="на-windows-10-11" class="level2">
<h2 class="anchored" data-anchor-id="на-windows-10-11">На Windows 10, 11</h2>
<p><strong>Шаг 1:</strong> Скачать R с официального сайта <a href="https://cran.r-project.org/bin/windows/base/" class="uri">https://cran.r-project.org/bin/windows/base/</a> Запустить установщик.</p>
<p><strong>Шаг 2:</strong> Скачать RStudio (бесплатную версию) <a href="https://www.rstudio.com/products/rstudio/download/" class="uri">https://www.rstudio.com/products/rstudio/download/</a> Запустить установщик с дефолтными параметрами.</p>
<p>Если вдруг у вас на компьютере юзернейм написан кириллицей, то переходите к разделу часто встречающихся проблем. Если же нет, поздравляю с подключением!</p>
</section>
<section id="на-macos" class="level2">
<h2 class="anchored" data-anchor-id="на-macos">На MacOS</h2>
<p>В целом, установка не сильно отличается от Windows.</p>
<p><strong>Шаг 1:</strong> Скачать R с официального сайта <a href="https://cran.r-project.org/bin/macosx/" class="uri">https://cran.r-project.org/bin/macosx/</a><br>
Запустить установщик</p>
<p><strong>Шаг 2:</strong> Скачать RStudio (бесплатную версию) <a href="https://posit.co/download/rstudio-desktop/" class="uri">https://posit.co/download/rstudio-desktop/</a><br>
Запустить установщик с дефолтными параметрами</p>
<p>Однако, я заметила, что пользователи с процессором M1 сталкиваются с определенными проблемами при установке пакетов. Например, при установке пакета <code>psych</code> нужен <code>gfortran</code> на устройстве. Можно поискать решения, погуглив, например, ‘install gfortran mac M1’. Одно из решений приведено по <a href="https://stackoverflow.com/questions/71088796/how-to-install-gfortran-for-macos-monterey-version-12-2-1-m1">ссылке</a>. Кроме того, по этой <a href="https://investcookies.ru/post/datatable_m1/data_table_arm/">ссылке</a> рекомендации как компилировать пакет <code>data.table</code> для M1 процессора.</p>
<p>UPD от 30.10.2024: я сама устанавливала R и RStudio и пакеты для работы на MacOS с процессором M3, и оказалось, что все работает без дополнительных настроек, просто скачиваем R и RStudio, и устанавливаем нужные пакеты как обычно через <code>install.packages()</code>. Возможно есть трудности с более старым процессорами линейки M.</p>
</section>
<section id="рекомендации-по-настройке-rstudio-перед-началом-работы" class="level2">
<h2 class="anchored" data-anchor-id="рекомендации-по-настройке-rstudio-перед-началом-работы">Рекомендации по настройке RStudio перед началом работы</h2>
<p>Первое, что советую сделать: настроить удаление RData при закрытии R и не восстанавливать при перезапуске.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/images/R_startup.jpg" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption>Нужно выбрать не сохранять RData при выходе и не восстанавливать при запуске R</figcaption>
</figure>
</div>
<p>Рекомендую почитать материал по эффективной организации работы в R по <a href="https://telegra.ph/R-how-to-organize-work-08-08">ссылке</a>, разобрано более подробно и с большим количеством ссылок на дополнительные материалы</p>
</section>
<section id="часто-встречающиеся-проблемы" class="level2">
<h2 class="anchored" data-anchor-id="часто-встречающиеся-проблемы">Часто встречающиеся проблемы</h2>
<p>Одна из распространенных проблем у пользователя R на Windows - это написанное кириллицей имя пользователя.</p>
<ul>
<li>Надежнее всего попробовать переименовать юзернейм например по этой <a href="https://altarena.ru/kak-pomenyat-imya-polzovatelya-v-vindovs-10-s-kirillitsy-na-latinitsu/">инструкции</a>. Можно погуглить еще, как переименовать пользователя в вашей версии Windows, вот еще одна <a href="https://www.wintips.org/how-to-rename-user-profile-folder-in-windows-10-8-7/">ссылка</a>.</li>
<li>Также можно переустановить систему с созданием юзернейма на латинице.</li>
</ul>
<p>Но если эти подходы кажутся сложными и долгими, можно изменить пути для записи устанавливаемых библиотек, чтобы они не содержали кириллицу. Однако, я не гарантирую, что это не повлечет проблем в дальнейшем, но этот путь кажется проще.</p>
<p>Также способ замены дефолтного пути может помочь, если по умолчанию R пытается поставить пакеты в папку OneDrive.</p>
<p><strong>Шаг 1:</strong> Создайте папку в корневом диске C:// или D:// для установки пакетов без кириллических символов и пробелов, например <code>C:/Rlib</code>.</p>
<p><strong>Шаг 2:</strong> Создайте папку для временных файлов без кириллических символов и пробелов, например <code>C:/Temp</code></p>
<p><strong>Шаг 3:</strong> Выполните в консоли Rstudio команду</p>
<pre><code>system("setx R_LIBS C:/Rlib")
system("setx TEMP C:/Temp")
system("setx TMP C:/Temp")</code></pre>
<p><strong>Шаг 4:</strong> Перезапустите RStudio (можно сделать сочетанием клавиш Ctrl+Shift+F10)</p>
<p><strong>Шаг 5:</strong> Проверьте, что R знает, куда ему ставить пакеты. Для этого выполните в консоли Rstudio команду <code>.libPaths()</code>. Скорее всего в выдаче будет две директории, исходная <code>C:/Users/Юзер/AppData/...</code>, и вновь созданная, то есть <code>C:/Rlib</code>. Чтобы переназначить новую директорию как дефолтную для установки пакетов запустите следующий код:</p>
<pre><code>myPaths &lt;- .libPaths()   # get the paths
myPaths &lt;- c(myPaths[2], myPaths[1])  # switch them
.libPaths(myPaths)  # reassign them</code></pre>
<p><strong>Шаг 6:</strong> Однако это понадобится делать каждый раз при перезапуске сессии RStudio. Чтобы сделать эту настройку постоянной, можно прописать этот код в файле Rprofile. Найти этот файл можно следующим образом: Tools -&gt; Global Options -&gt; General</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cdn.accelebrate.com/images/library/how-to-articles/r-rstudio-library/install-package-dialog5.png" class="img-fluid figure-img"></p>
<figcaption>здесь содержится путь к актуальной версии R</figcaption>
</figure>
</div>
<p>Перейти в <code>./library/base/R</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cdn.accelebrate.com/images/library/how-to-articles/r-rstudio-library/r-code.png" class="img-fluid figure-img"></p>
<figcaption>открыть файл Rprofile текстовым редактором, например Notepad++</figcaption>
</figure>
</div>
<p>В конце файла вставить строки, переназначающие нашу дефолтную библиотеку:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb5-1">myPaths &lt;- <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.libPaths</span><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb5-2">myPaths &lt;- c<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>myPaths<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">2</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> myPaths<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">1</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.libPaths</span><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>myPaths<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<p>Перезапустите RStudio. Надеюсь, это поможет успешно устанавливать пакеты и осваивать R!</p>
<p>Вот <a href="https://www.accelebrate.com/library/how-to-articles/r-rstudio-library">тут</a> по ссылке можно почитать более подробно и с картинками.</p>
<p>Небольшое напоминание - не рекомендуется использовать кириллицу и пробелы в названиях столбцов и файлов, потому что могут быть ошибки с кодировкой при пересылании файла, в результате чего кириллица превратится в ???<br>
Исправить это можно с помощью File - Reopen with encoding, выбрать UTF-8 в качестве кодировки. Но в целом рекомендую даже комментарии, не говоря уж об остальном писать только латиницей, это позволит избежать проблем с кодировкой в будущем.</p>
<p>При написании этого материала использовала следующие источники</p>
<ol type="1">
<li><a href="https://bdemeshev.github.io/installation/r/R_installation.html" class="uri">https://bdemeshev.github.io/installation/r/R_installation.html</a></li>
<li><a href="https://www.accelebrate.com/library/how-to-articles/r-rstudio-library" class="uri">https://www.accelebrate.com/library/how-to-articles/r-rstudio-library</a></li>
<li>Материалы со школы <a href="https://ngschool.eu/ngschool2022/">NGSchool</a></li>
</ol>
<p>Подписывайтесь на мой <a href="https://t.me/stats_for_science">телеграм-канал</a>, следите за новостями, обещаю интересные материалы по статистике и R!</p>
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/images/tlg_short.png" class="img-fluid"></p>


</section>

 ]]></description>
  <category>R</category>
  <guid>https://ubogoeva.github.io/R4Analytics/posts/how_to_install_R.html</guid>
  <pubDate>Sat, 29 Oct 2022 18:00:00 GMT</pubDate>
</item>
<item>
  <title>Anscombe’s quartet</title>
  <dc:creator>Elena U</dc:creator>
  <link>https://ubogoeva.github.io/R4Analytics/posts/ansombe_quartet.html</link>
  <description><![CDATA[ 
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(97025960, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/97025960" style="position:absolute; left:-9999px;" alt=""></div></noscript>
<!-- /Yandex.Metrika counter -->





<section id="квартет-энскомба-anscombes-quartet" class="level2">
<h2 class="anchored" data-anchor-id="квартет-энскомба-anscombes-quartet">Квартет Энскомба (Anscombe’s quartet)</h2>
<p>Квартет Энскомба представляет собой 4 набора данных с одинаковыми описательными статистиками (среднее, дисперсия, коэффициент корреляции), но с очень разными распределениями данных. Каждый набор содержит 11 значений (x, y). Francis Anscombe предложил эти наборы данных в 1973 году [1] в качестве иллюстрации важности полагаться не только на описательные статистики, но и визуализацию данных.</p>
<p>Этот набор данных встроен в R (вызвать можно просто набрав <code>anscombe</code> в консоли).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">anscombe</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   x1 x2 x3 x4    y1   y2    y3    y4
1  10 10 10  8  8.04 9.14  7.46  6.58
2   8  8  8  8  6.95 8.14  6.77  5.76
3  13 13 13  8  7.58 8.74 12.74  7.71
4   9  9  9  8  8.81 8.77  7.11  8.84
5  11 11 11  8  8.33 9.26  7.81  8.47
6  14 14 14  8  9.96 8.10  8.84  7.04
7   6  6  6  8  7.24 6.13  6.08  5.25
8   4  4  4 19  4.26 3.10  5.39 12.50
9  12 12 12  8 10.84 9.13  8.15  5.56
10  7  7  7  8  4.82 7.26  6.42  7.91
11  5  5  5  8  5.68 4.74  5.73  6.89</code></pre>
</div>
</div>
<p>Давайте попробуем посчитать описательные статистики самостоятельно.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># посчитаем среднее</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(anscombe, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, mean)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      x1       x2       x3       x4       y1       y2       y3       y4 
9.000000 9.000000 9.000000 9.000000 7.500909 7.500909 7.500000 7.500909 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># дисперсию</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(anscombe, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, var)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       x1        x2        x3        x4        y1        y2        y3        y4 
11.000000 11.000000 11.000000 11.000000  4.127269  4.127629  4.122620  4.123249 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># коэффициент корреляции, привожу два варианта как посчитать, интересно, какой кажется проще</span></span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2_dbl</span>(anscombe <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(x1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>x4), anscombe <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(y1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>y4), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(.x, .y))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       x1        x2        x3        x4 
0.8164205 0.8162365 0.8162867 0.8165214 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2_dbl</span>(anscombe[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>], anscombe[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>], <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(.x, .y))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       x1        x2        x3        x4 
0.8164205 0.8162365 0.8162867 0.8165214 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># еще простой способ отразить большинство описательных статистик - просто вызвать функцию summary</span></span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(anscombe)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       x1             x2             x3             x4           y1        
 Min.   : 4.0   Min.   : 4.0   Min.   : 4.0   Min.   : 8   Min.   : 4.260  
 1st Qu.: 6.5   1st Qu.: 6.5   1st Qu.: 6.5   1st Qu.: 8   1st Qu.: 6.315  
 Median : 9.0   Median : 9.0   Median : 9.0   Median : 8   Median : 7.580  
 Mean   : 9.0   Mean   : 9.0   Mean   : 9.0   Mean   : 9   Mean   : 7.501  
 3rd Qu.:11.5   3rd Qu.:11.5   3rd Qu.:11.5   3rd Qu.: 8   3rd Qu.: 8.570  
 Max.   :14.0   Max.   :14.0   Max.   :14.0   Max.   :19   Max.   :10.840  
       y2              y3              y4        
 Min.   :3.100   Min.   : 5.39   Min.   : 5.250  
 1st Qu.:6.695   1st Qu.: 6.25   1st Qu.: 6.170  
 Median :8.140   Median : 7.11   Median : 7.040  
 Mean   :7.501   Mean   : 7.50   Mean   : 7.501  
 3rd Qu.:8.950   3rd Qu.: 7.98   3rd Qu.: 8.190  
 Max.   :9.260   Max.   :12.74   Max.   :12.500  </code></pre>
</div>
</div>
<p>Можно увидеть, что описательные статистики совпадают. Что насчет распределения данных?</p>
</section>
<section id="построим-графики-распределения-значений" class="level2">
<h2 class="anchored" data-anchor-id="построим-графики-распределения-значений">Построим графики распределения значений</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># отрисовываем графики по очереди</span></span>
<span id="cb13-2">p1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(anscombe, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x1,y1))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'darkorange'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orangered'</span>, </span>
<span id="cb13-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb13-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dataset 1"</span> ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y ~ x"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">p2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(anscombe, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x2,y2))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'darkorange'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orangered'</span>, </span>
<span id="cb15-3">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dataset 2"</span> ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y ~ x"</span>, </span>
<span id="cb15-6">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span>
<span id="cb15-8">p3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(anscombe, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x3,y3))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-9">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'darkorange'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orangered'</span>, </span>
<span id="cb15-10">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dataset 3"</span> ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y ~ x"</span>, </span>
<span id="cb15-13">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span>
<span id="cb15-15">p4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(anscombe, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x4,y4))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-16">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'darkorange'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orangered'</span>, </span>
<span id="cb15-17">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dataset 4"</span> ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y ~ x"</span>, </span>
<span id="cb15-20">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span>
<span id="cb15-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># объединяем их в один плот с помощью библиотеки `patchwork`</span></span>
<span id="cb15-23">(p1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> p2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (p3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> p4)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ubogoeva.github.io/R4Analytics/posts/ansombe_quartet_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>Итак, как и ожидалось, распределения данных оказались совершенно разными. Подчеркну еще раз важность визуализации данных перед началом анализа. Не стоит опираться <strong>только</strong> на средние, медианы, дисперсию, поскольку эта информация должна дополняться визуальным представлением данных, даже хотя бы для себя.</p>
<p>Еще вот такой пример обманчивых описательных статистик:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.magnusson.io/files/datasaurus-dozen.png" class="img-fluid figure-img"></p>
<figcaption>обратите внимание на датазавтра наверху</figcaption>
</figure>
</div>
<p><br>
Кроме того, рекомендую строить диаграммы рассеяния (scatter plot) как в коде, приведенном выше, а не опираться только на боксплоты (boxplot), к примеру. Боксплоты сокращают информацию о данных, хотя и являются стандартом на конференциях и в публикациях. Про это можно почитать <a href="https://nightingaledvs.com/ive-stopped-using-box-plots-should-you/">здесь</a>. Думаю, для публикации неплохим вариантом могут быть violin plots или боксплоты с полупрозрачными точками, отрисованные с помощью <code>geom_jitter</code> (примеры применения можно посмотреть в <a href="../posts/types_of_error_bars.html">статье</a> про пределы погрешностей). Правда, это лучше сработает, если точек не больше ~30, на мой взгляд, иначе график будет сильно рябить.</p>
<p>О корректной, не вводящей в заблуждение читателя визуализации данных написано уже немало статей и книг, пока что приведу несколько ссылок для самостоятельного ознакомления:</p>
<ul>
<li><p><a href="https://www.youtube.com/watch?v=4MfUCX_KpdE">Лекция</a> Дженни Брайан (Jenny Bryan) о предобработке данных перед построением графиков</p></li>
<li><p><a href="https://clauswilke.com/dataviz/">Книга по визуализации данных</a>, доступна онлайн</p></li>
<li><p>Еще одна <a href="https://socviz.co/index.html">книга</a> по визуализации данных, доступна онлайн</p></li>
<li><p><a href="https://www.toptal.com/designers/ux/data-visualization-mistakes">Статья</a> про самые распространенные ошибки при построении графиков</p></li>
<li><p>Сайт <a href="https://colorbrewer2.org/#type=sequential&amp;scheme=YlGnBu&amp;n=3">colorbrewer</a> с хорошими сочетаниями цветов для отрисовки графиков</p></li>
</ul>
</section>
<section id="список-источников" class="level2">
<h2 class="anchored" data-anchor-id="список-источников">Список источников</h2>
<ol type="1">
<li>Anscombe, F. J. (1973). “Graphs in Statistical Analysis”. <em>American Statistician</em>. <strong>27</strong> (1): 17–21. <a href="https://en.wikipedia.org/wiki/Doi_(identifier)" title="Doi (identifier)">doi</a>:<a href="https://doi.org/10.1080%2F00031305.1973.10478966">10.1080/00031305.1973.10478966</a></li>
<li>https://en.wikipedia.org/wiki/Anscombe%27s_quartet</li>
</ol>
<p>Подписывайтесь на <a href="https://t.me/stats_for_science">телеграм-канал</a>, будет много интересного</p>
<p><img src="https://ubogoeva.github.io/R4Analytics/images/logo_final_tlg.png" class="img-fluid"></p>


</section>

 ]]></description>
  <category>statistics</category>
  <guid>https://ubogoeva.github.io/R4Analytics/posts/ansombe_quartet.html</guid>
  <pubDate>Tue, 18 Oct 2022 18:00:00 GMT</pubDate>
</item>
</channel>
</rss>
